2025-09-05 13:12:58,127 - __main__ - INFO - Bot starting...
2025-09-05 13:12:58,127 - aiogram.dispatcher - INFO - Start polling
2025-09-05 13:12:58,310 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 13:13:18,976 - __main__ - INFO - User 1226131544 started bot
2025-09-05 13:13:19,218 - aiogram.event - INFO - Update id=269252183 is handled. Duration 243 ms by bot id=8370724288
2025-09-05 13:13:23,863 - aiogram.event - INFO - Update id=269252184 is handled. Duration 89 ms by bot id=8370724288
2025-09-05 13:13:25,798 - aiogram.event - INFO - Update id=269252185 is handled. Duration 158 ms by bot id=8370724288
2025-09-05 13:13:27,706 - aiogram.event - INFO - Update id=269252186 is handled. Duration 162 ms by bot id=8370724288
2025-09-05 13:13:29,324 - aiogram.event - INFO - Update id=269252187 is handled. Duration 305 ms by bot id=8370724288
2025-09-05 13:13:31,352 - aiogram.event - INFO - Update id=269252188 is not handled. Duration 111 ms by bot id=8370724288
2025-09-05 13:13:31,352 - aiogram.event - ERROR - Cause exception while process update id=269252188 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x12005bec0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 292, in on_qty
    f"Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{format_cart(cb.from_user.id)}",
                  ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x12005bec0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-05 13:13:34,883 - aiogram.event - INFO - Update id=269252189 is not handled. Duration 8 ms by bot id=8370724288
2025-09-05 13:13:34,883 - aiogram.event - ERROR - Cause exception while process update id=269252189 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x11679cf50> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 292, in on_qty
    f"Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{format_cart(cb.from_user.id)}",
                  ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x11679cf50> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-05 13:13:35,301 - aiogram.event - INFO - Update id=269252190 is not handled. Duration 9 ms by bot id=8370724288
2025-09-05 13:13:35,302 - aiogram.event - ERROR - Cause exception while process update id=269252190 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x11679cec0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 292, in on_qty
    f"Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{format_cart(cb.from_user.id)}",
                  ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x11679cec0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-05 13:13:37,536 - aiogram.event - INFO - Update id=269252191 is handled. Duration 90 ms by bot id=8370724288
2025-09-05 13:13:38,769 - aiogram.event - INFO - Update id=269252192 is handled. Duration 72 ms by bot id=8370724288
2025-09-05 13:13:42,169 - __main__ - INFO - User 1226131544 requested help
2025-09-05 13:13:42,315 - aiogram.event - INFO - Update id=269252193 is handled. Duration 149 ms by bot id=8370724288
2025-09-05 13:13:44,419 - aiogram.event - INFO - Update id=269252194 is handled. Duration 162 ms by bot id=8370724288
2025-09-05 13:13:46,047 - aiogram.event - INFO - Update id=269252195 is handled. Duration 76 ms by bot id=8370724288
2025-09-05 13:13:49,399 - aiogram.event - INFO - Update id=269252196 is handled. Duration 360 ms by bot id=8370724288
2025-09-05 13:13:50,404 - aiogram.event - INFO - Update id=269252197 is handled. Duration 190 ms by bot id=8370724288
2025-09-05 13:13:51,932 - aiogram.event - INFO - Update id=269252198 is handled. Duration 161 ms by bot id=8370724288
2025-09-05 13:13:53,267 - aiogram.event - INFO - Update id=269252199 is not handled. Duration 10 ms by bot id=8370724288
2025-09-05 13:13:53,267 - aiogram.event - ERROR - Cause exception while process update id=269252199 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x1202d6f60> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 292, in on_qty
    f"Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{format_cart(cb.from_user.id)}",
                  ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x1202d6f60> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-05 13:14:20,424 - __main__ - INFO - User 1767628555 started bot
2025-09-05 13:14:20,625 - aiogram.event - INFO - Update id=269252200 is handled. Duration 203 ms by bot id=8370724288
2025-09-05 13:14:25,357 - aiogram.event - INFO - Update id=269252201 is handled. Duration 81 ms by bot id=8370724288
2025-09-05 13:14:27,245 - aiogram.event - INFO - Update id=269252202 is handled. Duration 77 ms by bot id=8370724288
2025-09-05 13:14:29,631 - aiogram.event - INFO - Update id=269252203 is handled. Duration 208 ms by bot id=8370724288
2025-09-05 13:14:32,761 - aiogram.event - INFO - Update id=269252204 is not handled. Duration 1 ms by bot id=8370724288
2025-09-05 13:14:46,909 - aiogram.event - INFO - Update id=269252205 is handled. Duration 283 ms by bot id=8370724288
2025-09-05 13:14:49,702 - aiogram.event - INFO - Update id=269252206 is handled. Duration 78 ms by bot id=8370724288
2025-09-05 13:14:50,621 - __main__ - INFO - User 1767628555 requested help
2025-09-05 13:14:50,697 - aiogram.event - INFO - Update id=269252207 is handled. Duration 76 ms by bot id=8370724288
2025-09-05 13:14:53,531 - aiogram.event - INFO - Update id=269252208 is handled. Duration 145 ms by bot id=8370724288
2025-09-05 14:11:55,136 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-09-05 14:11:55,139 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8370724288)
2025-09-05 14:12:06,340 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8370724288)
2025-09-05 14:28:29,824 - aiogram.event - INFO - Update id=269252209 is not handled. Duration 46 ms by bot id=8370724288
2025-09-05 14:28:29,826 - aiogram.event - ERROR - Cause exception while process update id=269252209 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x120290980> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 292, in on_qty
    f"Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{format_cart(cb.from_user.id)}",
                  ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x120290980> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-05 14:33:35,340 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 14:33:35,344 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 14:33:35,344 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 14:33:38,780 - __main__ - INFO - Bot starting...
2025-09-05 14:33:38,780 - aiogram.dispatcher - INFO - Start polling
2025-09-05 14:33:38,996 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 14:33:45,180 - __main__ - INFO - User 1226131544 requested help
2025-09-05 14:33:45,428 - aiogram.event - INFO - Update id=269252210 is handled. Duration 248 ms by bot id=8370724288
2025-09-05 14:33:47,478 - __main__ - INFO - User 1226131544 started bot
2025-09-05 14:33:47,611 - aiogram.event - INFO - Update id=269252211 is handled. Duration 133 ms by bot id=8370724288
2025-09-05 14:33:49,792 - aiogram.event - INFO - Update id=269252212 is handled. Duration 131 ms by bot id=8370724288
2025-09-05 14:33:52,314 - aiogram.event - INFO - Update id=269252213 is handled. Duration 154 ms by bot id=8370724288
2025-09-05 14:33:53,681 - aiogram.event - INFO - Update id=269252214 is handled. Duration 154 ms by bot id=8370724288
2025-09-05 14:33:57,354 - aiogram.event - INFO - Update id=269252215 is handled. Duration 520 ms by bot id=8370724288
2025-09-05 14:33:59,596 - aiogram.event - INFO - Update id=269252216 is handled. Duration 271 ms by bot id=8370724288
2025-09-05 14:34:02,248 - aiogram.event - INFO - Update id=269252217 is handled. Duration 165 ms by bot id=8370724288
2025-09-05 14:34:10,313 - aiogram.event - INFO - Update id=269252218 is handled. Duration 88 ms by bot id=8370724288
2025-09-05 14:34:11,722 - aiogram.event - INFO - Update id=269252219 is handled. Duration 75 ms by bot id=8370724288
2025-09-05 14:34:12,697 - aiogram.event - INFO - Update id=269252220 is handled. Duration 88 ms by bot id=8370724288
2025-09-05 14:34:16,529 - aiogram.event - INFO - Update id=269252221 is handled. Duration 130 ms by bot id=8370724288
2025-09-05 14:34:17,834 - aiogram.event - INFO - Update id=269252222 is handled. Duration 400 ms by bot id=8370724288
2025-09-05 14:34:18,661 - aiogram.event - INFO - Update id=269252223 is handled. Duration 143 ms by bot id=8370724288
2025-09-05 14:34:19,726 - aiogram.event - INFO - Update id=269252224 is handled. Duration 150 ms by bot id=8370724288
2025-09-05 14:40:49,483 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 14:40:49,486 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 14:40:49,486 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 14:40:53,285 - __main__ - INFO - Bot starting...
2025-09-05 14:40:53,285 - aiogram.dispatcher - INFO - Start polling
2025-09-05 14:40:53,551 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 14:41:04,119 - __main__ - INFO - User 1226131544 started bot
2025-09-05 14:41:04,355 - aiogram.event - INFO - Update id=269252225 is handled. Duration 237 ms by bot id=8370724288
2025-09-05 14:41:12,437 - aiogram.event - INFO - Update id=269252226 is handled. Duration 82 ms by bot id=8370724288
2025-09-05 14:41:13,812 - aiogram.event - INFO - Update id=269252227 is handled. Duration 160 ms by bot id=8370724288
2025-09-05 14:41:14,947 - aiogram.event - INFO - Update id=269252228 is handled. Duration 154 ms by bot id=8370724288
2025-09-05 14:41:16,110 - aiogram.event - INFO - Update id=269252229 is handled. Duration 214 ms by bot id=8370724288
2025-09-05 14:41:17,480 - aiogram.event - INFO - Update id=269252230 is handled. Duration 440 ms by bot id=8370724288
2025-09-05 14:41:22,971 - aiogram.event - INFO - Update id=269252231 is handled. Duration 99 ms by bot id=8370724288
2025-09-05 14:41:26,029 - aiogram.event - INFO - Update id=269252232 is handled. Duration 89 ms by bot id=8370724288
2025-09-05 14:41:48,186 - aiogram.event - INFO - Update id=269252233 is handled. Duration 187 ms by bot id=8370724288
2025-09-05 14:41:52,693 - aiogram.event - INFO - Update id=269252234 is handled. Duration 96 ms by bot id=8370724288
2025-09-05 14:41:57,896 - aiogram.event - INFO - Update id=269252235 is handled. Duration 149 ms by bot id=8370724288
2025-09-05 14:42:08,425 - aiogram.event - INFO - Update id=269252236 is handled. Duration 78 ms by bot id=8370724288
2025-09-05 14:42:12,949 - aiogram.event - INFO - Update id=269252237 is handled. Duration 637 ms by bot id=8370724288
2025-09-05 14:42:27,512 - __main__ - INFO - User 1226131544 requested help
2025-09-05 14:42:27,652 - aiogram.event - INFO - Update id=269252238 is handled. Duration 140 ms by bot id=8370724288
2025-09-05 14:42:30,084 - aiogram.event - INFO - Update id=269252239 is handled. Duration 2 ms by bot id=8370724288
2025-09-05 14:42:34,122 - aiogram.event - INFO - Update id=269252240 is handled. Duration 374 ms by bot id=8370724288
2025-09-05 14:43:14,165 - __main__ - INFO - User 1226131544 requested help
2025-09-05 14:43:14,412 - aiogram.event - INFO - Update id=269252241 is handled. Duration 248 ms by bot id=8370724288
2025-09-05 14:58:25,439 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-09-05 14:58:25,442 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8370724288)
2025-09-05 14:58:36,695 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8370724288)
2025-09-05 15:26:00,686 - aiogram.event - INFO - Update id=269252242 is handled. Duration 593 ms by bot id=8370724288
2025-09-05 15:26:03,650 - aiogram.event - INFO - Update id=269252243 is handled. Duration 405 ms by bot id=8370724288
2025-09-05 15:26:07,828 - aiogram.event - INFO - Update id=269252244 is handled. Duration 508 ms by bot id=8370724288
2025-09-05 15:26:09,537 - aiogram.event - INFO - Update id=269252245 is handled. Duration 148 ms by bot id=8370724288
2025-09-05 15:26:14,016 - aiogram.event - INFO - Update id=269252246 is handled. Duration 148 ms by bot id=8370724288
2025-09-05 15:26:20,990 - aiogram.event - INFO - Update id=269252247 is handled. Duration 1287 ms by bot id=8370724288
2025-09-05 15:26:33,142 - aiogram.event - INFO - Update id=269252248 is handled. Duration 407 ms by bot id=8370724288
2025-09-05 15:26:39,169 - aiogram.event - INFO - Update id=269252249 is handled. Duration 84 ms by bot id=8370724288
2025-09-05 15:26:41,274 - aiogram.event - INFO - Update id=269252250 is handled. Duration 83 ms by bot id=8370724288
2025-09-05 15:26:49,302 - aiogram.event - INFO - Update id=269252251 is handled. Duration 78 ms by bot id=8370724288
2025-09-05 15:26:57,812 - aiogram.event - INFO - Update id=269252252 is handled. Duration 90 ms by bot id=8370724288
2025-09-05 15:27:02,151 - aiogram.event - INFO - Update id=269252253 is handled. Duration 138 ms by bot id=8370724288
2025-09-05 15:27:06,709 - aiogram.event - INFO - Update id=269252254 is handled. Duration 79 ms by bot id=8370724288
2025-09-05 15:27:11,428 - aiogram.event - INFO - Update id=269252255 is handled. Duration 86 ms by bot id=8370724288
2025-09-05 15:27:16,250 - aiogram.event - INFO - Update id=269252256 is handled. Duration 506 ms by bot id=8370724288
2025-09-05 15:29:42,326 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 15:29:42,327 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 15:29:42,327 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 15:35:02,664 - __main__ - INFO - Bot starting...
2025-09-05 15:35:02,664 - aiogram.dispatcher - INFO - Start polling
2025-09-05 15:35:03,165 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 15:35:03,511 - aiogram.event - INFO - Update id=269252257 is handled. Duration 275 ms by bot id=8370724288
2025-09-05 15:35:07,412 - aiogram.event - INFO - Update id=269252258 is not handled. Duration 12 ms by bot id=8370724288
2025-09-05 15:35:07,412 - aiogram.event - ERROR - Cause exception while process update id=269252258 by bot id=8370724288
ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 1, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 280, in on_category_select
    await cb.message.answer(f"Товары категории:", reply_markup=category_products_ikb(category_key))
                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 114, in category_products_ikb
    products = ProductRepository.get_by_category(db, category.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/repositories.py", line 48, in get_by_category
    ).all()
      ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 1, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-05 15:35:14,579 - aiogram.event - INFO - Update id=269252259 is not handled. Duration 9 ms by bot id=8370724288
2025-09-05 15:35:14,579 - aiogram.event - ERROR - Cause exception while process update id=269252259 by bot id=8370724288
ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 2, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 280, in on_category_select
    await cb.message.answer(f"Товары категории:", reply_markup=category_products_ikb(category_key))
                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 114, in category_products_ikb
    products = ProductRepository.get_by_category(db, category.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/repositories.py", line 48, in get_by_category
    ).all()
      ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 2, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-05 15:35:16,120 - aiogram.event - INFO - Update id=269252260 is not handled. Duration 8 ms by bot id=8370724288
2025-09-05 15:35:16,120 - aiogram.event - ERROR - Cause exception while process update id=269252260 by bot id=8370724288
ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 3, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 280, in on_category_select
    await cb.message.answer(f"Товары категории:", reply_markup=category_products_ikb(category_key))
                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 114, in category_products_ikb
    products = ProductRepository.get_by_category(db, category.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/repositories.py", line 48, in get_by_category
    ).all()
      ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 3, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-05 15:35:31,093 - aiogram.event - INFO - Update id=269252261 is handled. Duration 2603 ms by bot id=8370724288
2025-09-05 15:35:34,169 - aiogram.event - INFO - Update id=269252262 is handled. Duration 79 ms by bot id=8370724288
2025-09-05 15:35:35,576 - __main__ - INFO - User 1226131544 requested help
2025-09-05 15:35:35,962 - aiogram.event - INFO - Update id=269252263 is handled. Duration 386 ms by bot id=8370724288
2025-09-05 15:35:40,169 - aiogram.event - INFO - Update id=269252264 is handled. Duration 78 ms by bot id=8370724288
2025-09-05 15:35:41,736 - aiogram.event - INFO - Update id=269252265 is handled. Duration 7 ms by bot id=8370724288
2025-09-05 15:35:43,474 - aiogram.event - INFO - Update id=269252266 is handled. Duration 77 ms by bot id=8370724288
2025-09-05 15:35:49,296 - aiogram.event - INFO - Update id=269252267 is handled. Duration 583 ms by bot id=8370724288
2025-09-05 15:35:50,610 - aiogram.event - INFO - Update id=269252268 is handled. Duration 111 ms by bot id=8370724288
2025-09-05 15:37:31,745 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 15:37:31,747 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 15:37:31,747 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 15:37:41,385 - __main__ - INFO - Bot starting...
2025-09-05 15:37:41,385 - aiogram.dispatcher - INFO - Start polling
2025-09-05 15:37:41,599 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 15:37:51,158 - __main__ - INFO - User 1226131544 requested help
2025-09-05 15:37:51,954 - aiogram.event - INFO - Update id=269252269 is handled. Duration 796 ms by bot id=8370724288
2025-09-05 15:37:53,304 - __main__ - INFO - User 1226131544 started bot
2025-09-05 15:37:53,535 - aiogram.event - INFO - Update id=269252270 is handled. Duration 231 ms by bot id=8370724288
2025-09-05 15:37:55,039 - aiogram.event - INFO - Update id=269252271 is handled. Duration 85 ms by bot id=8370724288
2025-09-05 15:37:56,189 - aiogram.event - INFO - Update id=269252272 is not handled. Duration 9 ms by bot id=8370724288
2025-09-05 15:37:56,189 - aiogram.event - ERROR - Cause exception while process update id=269252272 by bot id=8370724288
ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 1, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 282, in on_category_select
    await cb.message.answer(f"Товары категории:", reply_markup=category_products_ikb(category_key))
                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 114, in category_products_ikb
    products = ProductRepository.get_by_category(db, category.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/repositories.py", line 48, in get_by_category
    ).all()
      ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 1, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-05 15:37:59,381 - aiogram.event - INFO - Update id=269252273 is not handled. Duration 8 ms by bot id=8370724288
2025-09-05 15:37:59,382 - aiogram.event - ERROR - Cause exception while process update id=269252273 by bot id=8370724288
ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 2, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 282, in on_category_select
    await cb.message.answer(f"Товары категории:", reply_markup=category_products_ikb(category_key))
                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 114, in category_products_ikb
    products = ProductRepository.get_by_category(db, category.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/repositories.py", line 48, in get_by_category
    ).all()
      ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 2, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-05 15:38:08,772 - aiogram.event - INFO - Update id=269252274 is not handled. Duration 4 ms by bot id=8370724288
2025-09-05 15:38:08,772 - aiogram.event - ERROR - Cause exception while process update id=269252274 by bot id=8370724288
ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 2, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 282, in on_category_select
    await cb.message.answer(f"Товары категории:", reply_markup=category_products_ikb(category_key))
                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 114, in category_products_ikb
    products = ProductRepository.get_by_category(db, category.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/repositories.py", line 48, in get_by_category
    ).all()
      ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 2, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-05 15:41:53,011 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 15:41:53,017 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 15:41:53,017 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 15:42:17,764 - __main__ - INFO - Bot starting...
2025-09-05 15:42:17,764 - aiogram.dispatcher - INFO - Start polling
2025-09-05 15:42:17,922 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 15:42:22,746 - aiogram.event - INFO - Update id=269252275 is not handled. Duration 20 ms by bot id=8370724288
2025-09-05 15:42:22,746 - aiogram.event - ERROR - Cause exception while process update id=269252275 by bot id=8370724288
ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 1, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 282, in on_category_select
    await cb.message.answer(f"Товары категории:", reply_markup=category_products_ikb(category_key))
                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 114, in category_products_ikb
    products = ProductRepository.get_by_category(db, category.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/repositories.py", line 48, in get_by_category
    ).all()
      ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 1, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-05 15:42:34,849 - aiogram.event - INFO - Update id=269252276 is not handled. Duration 7 ms by bot id=8370724288
2025-09-05 15:42:34,849 - aiogram.event - ERROR - Cause exception while process update id=269252276 by bot id=8370724288
ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 1, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 282, in on_category_select
    await cb.message.answer(f"Товары категории:", reply_markup=category_products_ikb(category_key))
                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 114, in category_products_ikb
    products = ProductRepository.get_by_category(db, category.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/repositories.py", line 48, in get_by_category
    ).all()
      ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 1, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-05 15:45:15,136 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 15:45:15,140 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 15:45:15,141 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 16:18:18,710 - __main__ - INFO - Bot starting...
2025-09-05 16:18:18,710 - aiogram.dispatcher - INFO - Start polling
2025-09-05 16:18:18,888 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:18:26,332 - aiogram.event - INFO - Update id=269252277 is handled. Duration 288 ms by bot id=8370724288
2025-09-05 16:18:27,881 - aiogram.event - INFO - Update id=269252278 is not handled. Duration 12 ms by bot id=8370724288
2025-09-05 16:18:27,882 - aiogram.event - ERROR - Cause exception while process update id=269252278 by bot id=8370724288
ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 1, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 282, in on_category_select
    await cb.message.answer(f"Товары категории:", reply_markup=category_products_ikb(category_key))
                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 114, in category_products_ikb
    products = ProductRepository.get_by_category(db, category.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/repositories.py", line 44, in get_by_category
    ).all()
      ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 1, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-05 16:20:36,165 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 16:20:36,168 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:20:36,169 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 16:28:18,076 - __main__ - INFO - Bot starting...
2025-09-05 16:28:18,076 - aiogram.dispatcher - INFO - Start polling
2025-09-05 16:28:18,359 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:28:25,700 - aiogram.event - INFO - Update id=269252279 is handled. Duration 2218 ms by bot id=8370724288
2025-09-05 16:28:26,813 - __main__ - ERROR - Error in on_category_select: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 1, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-05 16:28:26,870 - aiogram.event - INFO - Update id=269252280 is handled. Duration 69 ms by bot id=8370724288
2025-09-05 16:28:28,756 - __main__ - ERROR - Error in on_category_select: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 2, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-05 16:28:28,814 - aiogram.event - INFO - Update id=269252281 is handled. Duration 62 ms by bot id=8370724288
2025-09-05 16:28:29,502 - __main__ - ERROR - Error in on_category_select: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 3, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-05 16:28:29,557 - aiogram.event - INFO - Update id=269252282 is handled. Duration 139 ms by bot id=8370724288
2025-09-05 16:28:33,544 - __main__ - INFO - User 1226131544 requested help
2025-09-05 16:28:33,622 - aiogram.event - INFO - Update id=269252283 is handled. Duration 78 ms by bot id=8370724288
2025-09-05 16:28:34,847 - aiogram.event - INFO - Update id=269252284 is handled. Duration 73 ms by bot id=8370724288
2025-09-05 16:28:36,430 - aiogram.event - INFO - Update id=269252285 is handled. Duration 74 ms by bot id=8370724288
2025-09-05 16:28:40,626 - aiogram.event - INFO - Update id=269252286 is handled. Duration 3 ms by bot id=8370724288
2025-09-05 16:28:45,341 - aiogram.event - INFO - Update id=269252287 is handled. Duration 4 ms by bot id=8370724288
2025-09-05 16:28:48,378 - aiogram.event - INFO - Update id=269252288 is handled. Duration 113 ms by bot id=8370724288
2025-09-05 16:28:50,655 - aiogram.event - INFO - Update id=269252289 is handled. Duration 76 ms by bot id=8370724288
2025-09-05 16:28:52,785 - __main__ - ERROR - Error in on_category_select: (psycopg2.errors.UndefinedColumn) column products.images does not exist
LINE 1: ...products_price, products.sizes AS products_sizes, products.i...
                                                             ^

[SQL: SELECT products.id AS products_id, products.category_id AS products_category_id, products.product_id AS products_product_id, products.name AS products_name, products.description AS products_description, products.price AS products_price, products.sizes AS products_sizes, products.images AS products_images, products.is_active AS products_is_active, products.created_at AS products_created_at 
FROM products 
WHERE products.category_id = %(category_id_1)s AND products.is_active = %(is_active_1)s]
[parameters: {'category_id_1': 1, 'is_active_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-05 16:28:52,841 - aiogram.event - INFO - Update id=269252290 is handled. Duration 60 ms by bot id=8370724288
2025-09-05 16:30:00,611 - aiogram.event - INFO - Update id=269252291 is not handled. Duration 8 ms by bot id=8370724288
2025-09-05 16:30:58,719 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 16:30:58,724 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:30:58,725 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 16:32:06,946 - __main__ - INFO - Bot starting...
2025-09-05 16:32:06,946 - aiogram.dispatcher - INFO - Start polling
2025-09-05 16:32:07,270 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:32:15,010 - __main__ - INFO - User 1226131544 requested help
2025-09-05 16:32:16,203 - aiogram.event - INFO - Update id=269252292 is handled. Duration 1193 ms by bot id=8370724288
2025-09-05 16:32:18,414 - __main__ - INFO - User 1226131544 started bot
2025-09-05 16:32:18,519 - aiogram.event - INFO - Update id=269252293 is handled. Duration 105 ms by bot id=8370724288
2025-09-05 16:32:23,409 - aiogram.event - INFO - Update id=269252294 is handled. Duration 90 ms by bot id=8370724288
2025-09-05 16:32:25,452 - aiogram.event - INFO - Update id=269252295 is handled. Duration 302 ms by bot id=8370724288
2025-09-05 16:32:28,274 - aiogram.event - INFO - Update id=269252296 is handled. Duration 423 ms by bot id=8370724288
2025-09-05 16:32:29,478 - aiogram.event - INFO - Update id=269252297 is handled. Duration 138 ms by bot id=8370724288
2025-09-05 16:32:30,530 - aiogram.event - INFO - Update id=269252298 is handled. Duration 155 ms by bot id=8370724288
2025-09-05 16:32:34,606 - aiogram.event - INFO - Update id=269252299 is handled. Duration 93 ms by bot id=8370724288
2025-09-05 16:32:38,529 - aiogram.event - INFO - Update id=269252300 is handled. Duration 137 ms by bot id=8370724288
2025-09-05 16:32:41,183 - aiogram.event - INFO - Update id=269252301 is handled. Duration 77 ms by bot id=8370724288
2025-09-05 16:32:47,361 - aiogram.event - INFO - Update id=269252302 is handled. Duration 329 ms by bot id=8370724288
2025-09-05 16:32:50,215 - aiogram.event - INFO - Update id=269252303 is handled. Duration 154 ms by bot id=8370724288
2025-09-05 16:32:52,307 - aiogram.event - INFO - Update id=269252304 is handled. Duration 136 ms by bot id=8370724288
2025-09-05 16:32:55,471 - aiogram.event - INFO - Update id=269252305 is handled. Duration 76 ms by bot id=8370724288
2025-09-05 16:32:57,622 - aiogram.event - INFO - Update id=269252306 is handled. Duration 72 ms by bot id=8370724288
2025-09-05 16:33:01,367 - aiogram.event - INFO - Update id=269252307 is handled. Duration 665 ms by bot id=8370724288
2025-09-05 16:33:03,543 - __main__ - INFO - User 1226131544 requested help
2025-09-05 16:33:04,100 - aiogram.event - INFO - Update id=269252308 is handled. Duration 557 ms by bot id=8370724288
2025-09-05 16:33:07,615 - aiogram.event - INFO - Update id=269252309 is handled. Duration 3 ms by bot id=8370724288
2025-09-05 16:33:09,705 - aiogram.event - INFO - Update id=269252310 is handled. Duration 79 ms by bot id=8370724288
2025-09-05 16:33:24,507 - aiogram.event - INFO - Update id=269252311 is handled. Duration 79 ms by bot id=8370724288
2025-09-05 16:34:06,389 - aiogram.event - INFO - Update id=269252312 is not handled. Duration 5 ms by bot id=8370724288
2025-09-05 16:34:10,206 - __main__ - INFO - User 1226131544 requested help
2025-09-05 16:34:10,644 - aiogram.event - INFO - Update id=269252313 is handled. Duration 438 ms by bot id=8370724288
2025-09-05 16:34:15,738 - aiogram.event - INFO - Update id=269252314 is handled. Duration 5 ms by bot id=8370724288
2025-09-05 16:34:17,757 - aiogram.event - INFO - Update id=269252315 is handled. Duration 78 ms by bot id=8370724288
2025-09-05 16:37:20,166 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 16:37:20,170 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:37:20,170 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 16:37:24,098 - __main__ - INFO - Bot starting...
2025-09-05 16:37:24,099 - aiogram.dispatcher - INFO - Start polling
2025-09-05 16:37:24,362 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:37:28,469 - __main__ - INFO - User 1226131544 requested help
2025-09-05 16:37:28,689 - aiogram.event - INFO - Update id=269252316 is handled. Duration 220 ms by bot id=8370724288
2025-09-05 16:37:29,833 - aiogram.event - INFO - Update id=269252317 is handled. Duration 99 ms by bot id=8370724288
2025-09-05 16:37:41,154 - aiogram.event - INFO - Update id=269252318 is not handled. Duration 5 ms by bot id=8370724288
2025-09-05 16:37:48,347 - aiogram.event - INFO - Update id=269252319 is handled. Duration 186 ms by bot id=8370724288
2025-09-05 16:37:50,397 - aiogram.event - INFO - Update id=269252320 is handled. Duration 91 ms by bot id=8370724288
2025-09-05 16:37:51,401 - aiogram.event - INFO - Update id=269252321 is handled. Duration 241 ms by bot id=8370724288
2025-09-05 16:37:52,275 - aiogram.event - INFO - Update id=269252322 is handled. Duration 169 ms by bot id=8370724288
2025-09-05 16:37:53,836 - aiogram.event - INFO - Update id=269252323 is handled. Duration 144 ms by bot id=8370724288
2025-09-05 16:37:55,386 - aiogram.event - INFO - Update id=269252324 is handled. Duration 711 ms by bot id=8370724288
2025-09-05 16:37:57,497 - aiogram.event - INFO - Update id=269252325 is handled. Duration 349 ms by bot id=8370724288
2025-09-05 16:37:58,641 - aiogram.event - INFO - Update id=269252326 is handled. Duration 74 ms by bot id=8370724288
2025-09-05 16:38:00,979 - __main__ - INFO - User 1226131544 requested help
2025-09-05 16:38:01,390 - aiogram.event - INFO - Update id=269252327 is handled. Duration 412 ms by bot id=8370724288
2025-09-05 16:38:05,092 - aiogram.event - INFO - Update id=269252328 is handled. Duration 81 ms by bot id=8370724288
2025-09-05 16:38:08,362 - aiogram.event - INFO - Update id=269252329 is handled. Duration 217 ms by bot id=8370724288
2025-09-05 16:38:11,579 - aiogram.event - INFO - Update id=269252330 is handled. Duration 77 ms by bot id=8370724288
2025-09-05 16:38:16,285 - aiogram.event - INFO - Update id=269252331 is handled. Duration 85 ms by bot id=8370724288
2025-09-05 16:38:21,550 - aiogram.event - INFO - Update id=269252332 is handled. Duration 3 ms by bot id=8370724288
2025-09-05 16:38:25,999 - aiogram.event - INFO - Update id=269252333 is handled. Duration 100 ms by bot id=8370724288
2025-09-05 16:39:32,280 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 16:39:32,283 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:39:32,284 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 16:40:00,450 - __main__ - INFO - Bot starting...
2025-09-05 16:40:00,450 - aiogram.dispatcher - INFO - Start polling
2025-09-05 16:40:00,692 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:40:07,059 - __main__ - INFO - User 1226131544 requested help
2025-09-05 16:40:07,339 - aiogram.event - INFO - Update id=269252334 is handled. Duration 280 ms by bot id=8370724288
2025-09-05 16:40:08,555 - aiogram.event - INFO - Update id=269252335 is handled. Duration 112 ms by bot id=8370724288
2025-09-05 16:40:10,226 - aiogram.event - INFO - Update id=269252336 is handled. Duration 109 ms by bot id=8370724288
2025-09-05 16:40:12,442 - aiogram.event - INFO - Update id=269252337 is handled. Duration 74 ms by bot id=8370724288
2025-09-05 16:50:01,483 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-09-05 16:50:01,486 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8370724288)
2025-09-05 16:50:14,234 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8370724288)
2025-09-05 16:52:43,404 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 16:52:43,407 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:52:43,407 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 16:52:47,098 - __main__ - INFO - Bot starting...
2025-09-05 16:52:47,098 - aiogram.dispatcher - INFO - Start polling
2025-09-05 16:52:47,369 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:52:51,861 - __main__ - INFO - User 1226131544 requested help
2025-09-05 16:52:52,319 - aiogram.event - INFO - Update id=269252338 is handled. Duration 457 ms by bot id=8370724288
2025-09-05 16:52:54,079 - aiogram.event - INFO - Update id=269252339 is handled. Duration 428 ms by bot id=8370724288
2025-09-05 16:53:03,764 - aiogram.event - INFO - Update id=269252340 is not handled. Duration 3 ms by bot id=8370724288
2025-09-05 16:53:12,707 - aiogram.event - INFO - Update id=269252341 is not handled. Duration 5 ms by bot id=8370724288
2025-09-05 16:53:12,708 - aiogram.event - ERROR - Cause exception while process update id=269252341 by bot id=8370724288
AttributeError: type object 'User' has no attribute 'is_admin'
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 849, in check_db
    admin_count = db.query(User).filter(User.is_admin == True).count()
                                        ^^^^^^^^^^^^^
AttributeError: type object 'User' has no attribute 'is_admin'
2025-09-05 16:54:16,879 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 16:54:16,881 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:54:16,881 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 16:56:44,173 - __main__ - INFO - Bot starting...
2025-09-05 16:56:44,173 - aiogram.dispatcher - INFO - Start polling
2025-09-05 16:56:44,752 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:56:51,341 - __main__ - INFO - User 1226131544 requested help
2025-09-05 16:56:51,555 - aiogram.event - INFO - Update id=269252342 is handled. Duration 215 ms by bot id=8370724288
2025-09-05 16:56:57,144 - aiogram.event - INFO - Update id=269252343 is handled. Duration 94 ms by bot id=8370724288
2025-09-05 16:57:27,235 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 16:57:27,238 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:57:27,238 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 16:57:30,148 - __main__ - INFO - Bot starting...
2025-09-05 16:57:30,148 - aiogram.dispatcher - INFO - Start polling
2025-09-05 16:57:30,350 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:57:37,741 - aiogram.event - INFO - Update id=269252344 is handled. Duration 201 ms by bot id=8370724288
2025-09-05 16:57:39,116 - aiogram.event - INFO - Update id=269252345 is handled. Duration 149 ms by bot id=8370724288
2025-09-05 16:58:07,530 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 16:58:07,532 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:58:07,532 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 16:58:11,031 - __main__ - INFO - Bot starting...
2025-09-05 16:58:11,031 - aiogram.dispatcher - INFO - Start polling
2025-09-05 16:58:11,246 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:58:15,065 - __main__ - INFO - User 1226131544 requested help
2025-09-05 16:58:15,612 - aiogram.event - INFO - Update id=269252346 is handled. Duration 546 ms by bot id=8370724288
2025-09-05 16:58:16,808 - aiogram.event - INFO - Update id=269252347 is handled. Duration 346 ms by bot id=8370724288
2025-09-05 16:58:20,139 - aiogram.event - INFO - Update id=269252348 is handled. Duration 80 ms by bot id=8370724288
2025-09-05 16:58:22,234 - aiogram.event - INFO - Update id=269252349 is handled. Duration 202 ms by bot id=8370724288
2025-09-05 16:58:23,314 - aiogram.event - INFO - Update id=269252350 is handled. Duration 161 ms by bot id=8370724288
2025-09-05 16:58:25,011 - aiogram.event - INFO - Update id=269252351 is handled. Duration 431 ms by bot id=8370724288
2025-09-05 16:58:26,150 - aiogram.event - INFO - Update id=269252352 is handled. Duration 128 ms by bot id=8370724288
2025-09-05 16:58:27,473 - aiogram.event - INFO - Update id=269252353 is handled. Duration 138 ms by bot id=8370724288
2025-09-05 16:58:28,851 - aiogram.event - INFO - Update id=269252354 is handled. Duration 161 ms by bot id=8370724288
2025-09-05 16:58:30,102 - aiogram.event - INFO - Update id=269252355 is handled. Duration 85 ms by bot id=8370724288
2025-09-05 16:58:31,218 - __main__ - INFO - User 1226131544 requested help
2025-09-05 16:58:31,288 - aiogram.event - INFO - Update id=269252356 is handled. Duration 70 ms by bot id=8370724288
2025-09-05 16:58:32,904 - aiogram.event - INFO - Update id=269252357 is handled. Duration 74 ms by bot id=8370724288
2025-09-05 16:58:35,576 - aiogram.event - INFO - Update id=269252358 is handled. Duration 93 ms by bot id=8370724288
2025-09-05 16:58:38,138 - aiogram.event - INFO - Update id=269252359 is handled. Duration 73 ms by bot id=8370724288
2025-09-05 16:58:42,447 - aiogram.event - INFO - Update id=269252360 is handled. Duration 76 ms by bot id=8370724288
2025-09-05 16:58:49,746 - aiogram.event - INFO - Update id=269252361 is not handled. Duration 3 ms by bot id=8370724288
2025-09-05 16:59:21,857 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 16:59:21,859 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:59:21,859 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 16:59:23,769 - __main__ - INFO - Bot starting...
2025-09-05 16:59:23,769 - aiogram.dispatcher - INFO - Start polling
2025-09-05 16:59:23,988 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 16:59:27,515 - aiogram.event - INFO - Update id=269252362 is handled. Duration 612 ms by bot id=8370724288
2025-09-05 17:03:16,776 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-05 17:03:16,779 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 17:03:16,779 - aiogram.dispatcher - INFO - Polling stopped
2025-09-05 17:14:56,013 - __main__ - INFO - Bot starting...
2025-09-05 17:14:56,013 - aiogram.dispatcher - INFO - Start polling
2025-09-05 17:14:56,176 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-05 17:15:15,032 - aiogram.event - INFO - Update id=269252363 is handled. Duration 249 ms by bot id=8370724288
2025-09-05 17:16:11,828 - aiogram.event - INFO - Update id=269252364 is handled. Duration 185 ms by bot id=8370724288
2025-09-05 17:16:15,394 - aiogram.event - INFO - Update id=269252365 is handled. Duration 85 ms by bot id=8370724288
2025-09-05 17:16:19,532 - aiogram.event - INFO - Update id=269252366 is handled. Duration 360 ms by bot id=8370724288
2025-09-05 17:16:21,171 - aiogram.event - INFO - Update id=269252367 is handled. Duration 282 ms by bot id=8370724288
2025-09-05 17:16:23,024 - aiogram.event - INFO - Update id=269252368 is handled. Duration 135 ms by bot id=8370724288
2025-09-05 17:16:24,446 - aiogram.event - INFO - Update id=269252369 is handled. Duration 310 ms by bot id=8370724288
2025-09-05 17:16:26,253 - aiogram.event - INFO - Update id=269252370 is handled. Duration 566 ms by bot id=8370724288
2025-09-05 17:16:26,784 - aiogram.event - INFO - Update id=269252371 is handled. Duration 164 ms by bot id=8370724288
2025-09-05 17:16:31,969 - __main__ - INFO - User 1226131544 requested help
2025-09-05 17:16:32,042 - aiogram.event - INFO - Update id=269252372 is handled. Duration 73 ms by bot id=8370724288
2025-09-05 17:24:52,434 - aiogram.event - INFO - Update id=269252373 is handled. Duration 869 ms by bot id=8370724288
2025-09-05 17:24:55,118 - aiogram.event - INFO - Update id=269252374 is handled. Duration 82 ms by bot id=8370724288
2025-09-05 17:29:01,305 - aiogram.event - INFO - Update id=269252375 is handled. Duration 288 ms by bot id=8370724288
2025-09-05 17:29:02,469 - aiogram.event - INFO - Update id=269252376 is handled. Duration 156 ms by bot id=8370724288
2025-09-05 17:29:03,488 - aiogram.event - INFO - Update id=269252377 is handled. Duration 169 ms by bot id=8370724288
2025-09-05 17:29:04,677 - aiogram.event - INFO - Update id=269252378 is handled. Duration 131 ms by bot id=8370724288
2025-09-05 17:29:06,080 - aiogram.event - INFO - Update id=269252379 is handled. Duration 403 ms by bot id=8370724288
2025-09-05 17:29:07,498 - aiogram.event - INFO - Update id=269252380 is handled. Duration 73 ms by bot id=8370724288
2025-09-05 17:29:10,751 - aiogram.event - INFO - Update id=269252381 is handled. Duration 74 ms by bot id=8370724288
2025-09-05 17:29:13,918 - aiogram.event - INFO - Update id=269252382 is handled. Duration 715 ms by bot id=8370724288
2025-09-09 14:46:28,479 - __main__ - INFO - Bot starting...
2025-09-09 14:46:28,480 - aiogram.dispatcher - INFO - Start polling
2025-09-09 14:46:28,720 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-09 14:46:28,793 - aiogram.event - INFO - Update id=269252383 is not handled. Duration 1 ms by bot id=8370724288
2025-09-09 14:46:56,758 - __main__ - INFO - User 1226131544 started bot
2025-09-09 14:46:57,305 - aiogram.event - INFO - Update id=269252384 is handled. Duration 548 ms by bot id=8370724288
2025-09-09 14:46:59,691 - aiogram.event - INFO - Update id=269252385 is handled. Duration 99 ms by bot id=8370724288
2025-09-09 14:47:01,472 - aiogram.event - INFO - Update id=269252386 is handled. Duration 408 ms by bot id=8370724288
2025-09-09 14:47:02,274 - aiogram.event - INFO - Update id=269252387 is handled. Duration 558 ms by bot id=8370724288
2025-09-09 14:47:05,328 - aiogram.event - INFO - Update id=269252388 is handled. Duration 176 ms by bot id=8370724288
2025-09-09 14:47:07,341 - aiogram.event - INFO - Update id=269252389 is handled. Duration 178 ms by bot id=8370724288
2025-09-09 14:47:10,515 - aiogram.event - INFO - Update id=269252390 is handled. Duration 99 ms by bot id=8370724288
2025-09-09 14:47:13,286 - aiogram.event - INFO - Update id=269252391 is handled. Duration 139 ms by bot id=8370724288
2025-09-09 14:47:20,852 - aiogram.event - INFO - Update id=269252392 is not handled. Duration 5 ms by bot id=8370724288
2025-09-09 14:47:20,852 - aiogram.event - ERROR - Cause exception while process update id=269252392 by bot id=8370724288
AttributeError: type object 'CartRepository' has no attribute 'clear_cart'
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 389, in on_cart_action
    CartRepository.clear_cart(db, user.id)
    ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'CartRepository' has no attribute 'clear_cart'
2025-09-09 14:47:23,162 - aiogram.event - INFO - Update id=269252393 is not handled. Duration 6 ms by bot id=8370724288
2025-09-09 14:47:23,163 - aiogram.event - ERROR - Cause exception while process update id=269252393 by bot id=8370724288
AttributeError: type object 'CartRepository' has no attribute 'clear_cart'
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 389, in on_cart_action
    CartRepository.clear_cart(db, user.id)
    ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'CartRepository' has no attribute 'clear_cart'
2025-09-09 14:47:23,676 - aiogram.event - INFO - Update id=269252394 is not handled. Duration 4 ms by bot id=8370724288
2025-09-09 14:47:23,676 - aiogram.event - ERROR - Cause exception while process update id=269252394 by bot id=8370724288
AttributeError: type object 'CartRepository' has no attribute 'clear_cart'
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 389, in on_cart_action
    CartRepository.clear_cart(db, user.id)
    ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'CartRepository' has no attribute 'clear_cart'
2025-09-09 14:47:24,275 - aiogram.event - INFO - Update id=269252395 is not handled. Duration 5 ms by bot id=8370724288
2025-09-09 14:47:24,276 - aiogram.event - ERROR - Cause exception while process update id=269252395 by bot id=8370724288
AttributeError: type object 'CartRepository' has no attribute 'clear_cart'
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 389, in on_cart_action
    CartRepository.clear_cart(db, user.id)
    ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'CartRepository' has no attribute 'clear_cart'
2025-09-09 14:47:29,463 - aiogram.event - INFO - Update id=269252396 is not handled. Duration 2 ms by bot id=8370724288
2025-09-09 14:47:29,463 - aiogram.event - ERROR - Cause exception while process update id=269252396 by bot id=8370724288
AttributeError: type object 'OrderRepository' has no attribute 'get_user_orders'
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 414, in on_orders
    orders = OrderRepository.get_user_orders(db, user.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'OrderRepository' has no attribute 'get_user_orders'. Did you mean: 'get_all_orders'?
2025-09-09 14:47:40,191 - aiogram.event - INFO - Update id=269252397 is handled. Duration 232 ms by bot id=8370724288
2025-09-09 14:47:46,063 - aiogram.event - INFO - Update id=269252398 is handled. Duration 120 ms by bot id=8370724288
2025-09-09 14:47:47,198 - aiogram.event - INFO - Update id=269252399 is not handled. Duration 7 ms by bot id=8370724288
2025-09-09 14:47:47,199 - aiogram.event - ERROR - Cause exception while process update id=269252399 by bot id=8370724288
AttributeError: type object 'OrderRepository' has no attribute 'get_user_orders'
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 414, in on_orders
    orders = OrderRepository.get_user_orders(db, user.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'OrderRepository' has no attribute 'get_user_orders'. Did you mean: 'get_all_orders'?
2025-09-09 14:47:51,842 - aiogram.event - INFO - Update id=269252400 is handled. Duration 103 ms by bot id=8370724288
2025-09-09 14:47:53,323 - aiogram.event - INFO - Update id=269252401 is not handled. Duration 5 ms by bot id=8370724288
2025-09-09 14:47:53,324 - aiogram.event - ERROR - Cause exception while process update id=269252401 by bot id=8370724288
AttributeError: type object 'CartRepository' has no attribute 'clear_cart'
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 389, in on_cart_action
    CartRepository.clear_cart(db, user.id)
    ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'CartRepository' has no attribute 'clear_cart'
2025-09-09 14:52:55,217 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-09 14:52:55,220 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-09 14:52:55,220 - aiogram.dispatcher - INFO - Polling stopped
2025-09-09 14:52:59,922 - __main__ - INFO - Bot starting...
2025-09-09 14:52:59,922 - aiogram.dispatcher - INFO - Start polling
2025-09-09 14:53:00,112 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-09 14:53:03,130 - aiogram.event - INFO - Update id=269252402 is handled. Duration 317 ms by bot id=8370724288
2025-09-09 14:53:04,454 - aiogram.event - INFO - Update id=269252403 is handled. Duration 91 ms by bot id=8370724288
2025-09-09 14:53:06,640 - aiogram.event - INFO - Update id=269252404 is handled. Duration 154 ms by bot id=8370724288
2025-09-09 14:53:08,004 - aiogram.event - INFO - Update id=269252405 is handled. Duration 235 ms by bot id=8370724288
2025-09-09 14:53:11,040 - aiogram.event - INFO - Update id=269252406 is handled. Duration 91 ms by bot id=8370724288
2025-09-09 14:53:13,424 - aiogram.event - INFO - Update id=269252407 is handled. Duration 210 ms by bot id=8370724288
2025-09-09 14:53:16,148 - aiogram.event - INFO - Update id=269252408 is handled. Duration 213 ms by bot id=8370724288
2025-09-09 14:53:18,637 - aiogram.event - INFO - Update id=269252409 is handled. Duration 229 ms by bot id=8370724288
2025-09-09 14:53:20,740 - aiogram.event - INFO - Update id=269252410 is handled. Duration 397 ms by bot id=8370724288
2025-09-09 14:53:21,591 - aiogram.event - INFO - Update id=269252411 is handled. Duration 148 ms by bot id=8370724288
2025-09-09 14:53:23,469 - aiogram.event - INFO - Update id=269252412 is handled. Duration 99 ms by bot id=8370724288
2025-09-09 14:53:24,836 - aiogram.event - INFO - Update id=269252413 is handled. Duration 83 ms by bot id=8370724288
2025-09-09 14:53:26,433 - aiogram.event - INFO - Update id=269252414 is handled. Duration 138 ms by bot id=8370724288
2025-09-09 14:53:27,559 - aiogram.event - INFO - Update id=269252415 is handled. Duration 187 ms by bot id=8370724288
2025-09-09 14:53:29,307 - aiogram.event - INFO - Update id=269252416 is handled. Duration 167 ms by bot id=8370724288
2025-09-09 14:53:30,556 - aiogram.event - INFO - Update id=269252417 is handled. Duration 318 ms by bot id=8370724288
2025-09-09 14:53:31,747 - aiogram.event - INFO - Update id=269252418 is handled. Duration 132 ms by bot id=8370724288
2025-09-09 14:53:34,476 - aiogram.event - INFO - Update id=269252419 is handled. Duration 175 ms by bot id=8370724288
2025-09-09 14:53:37,562 - aiogram.event - INFO - Update id=269252420 is handled. Duration 147 ms by bot id=8370724288
2025-09-09 14:53:42,001 - aiogram.event - INFO - Update id=269252421 is handled. Duration 75 ms by bot id=8370724288
2025-09-09 14:53:43,643 - aiogram.event - INFO - Update id=269252422 is handled. Duration 165 ms by bot id=8370724288
2025-09-09 14:53:49,430 - aiogram.event - INFO - Update id=269252423 is handled. Duration 76 ms by bot id=8370724288
2025-09-09 14:53:52,652 - aiogram.event - INFO - Update id=269252424 is handled. Duration 170 ms by bot id=8370724288
2025-09-09 14:53:56,986 - aiogram.event - INFO - Update id=269252425 is handled. Duration 213 ms by bot id=8370724288
2025-09-09 14:54:01,089 - aiogram.event - INFO - Update id=269252426 is handled. Duration 113 ms by bot id=8370724288
2025-09-09 14:54:02,566 - aiogram.event - INFO - Update id=269252427 is handled. Duration 209 ms by bot id=8370724288
2025-09-09 14:54:08,585 - aiogram.event - INFO - Update id=269252428 is handled. Duration 225 ms by bot id=8370724288
2025-09-09 14:54:10,482 - aiogram.event - INFO - Update id=269252429 is handled. Duration 150 ms by bot id=8370724288
2025-09-09 14:54:12,019 - aiogram.event - INFO - Update id=269252430 is handled. Duration 93 ms by bot id=8370724288
2025-09-09 14:54:13,083 - aiogram.event - INFO - Update id=269252431 is handled. Duration 74 ms by bot id=8370724288
2025-09-09 16:06:20,466 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-09-09 16:06:20,468 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8370724288)
2025-09-09 16:06:22,039 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8370724288)
2025-09-09 16:06:22,052 - __main__ - INFO - User 1226131544 started bot
2025-09-09 16:06:22,567 - aiogram.event - INFO - Update id=269252437 is handled. Duration 515 ms by bot id=8370724288
2025-09-09 16:06:22,756 - aiogram.event - INFO - Update id=269252432 is handled. Duration 715 ms by bot id=8370724288
2025-09-09 16:06:22,760 - aiogram.event - INFO - Update id=269252433 is handled. Duration 718 ms by bot id=8370724288
2025-09-09 16:06:22,914 - aiogram.event - INFO - Update id=269252435 is handled. Duration 871 ms by bot id=8370724288
2025-09-09 16:06:22,915 - aiogram.event - INFO - Update id=269252434 is handled. Duration 872 ms by bot id=8370724288
2025-09-09 16:06:30,765 - aiogram.event - INFO - Update id=269252438 is handled. Duration 148 ms by bot id=8370724288
2025-09-09 16:06:37,956 - aiogram.event - INFO - Update id=269252439 is handled. Duration 78 ms by bot id=8370724288
2025-09-09 16:07:00,480 - aiogram.event - INFO - Update id=269252440 is handled. Duration 216 ms by bot id=8370724288
2025-09-09 16:07:01,762 - aiogram.event - INFO - Update id=269252441 is handled. Duration 152 ms by bot id=8370724288
2025-09-09 16:07:04,834 - aiogram.event - INFO - Update id=269252442 is handled. Duration 164 ms by bot id=8370724288
2025-09-09 16:07:05,839 - aiogram.event - INFO - Update id=269252443 is handled. Duration 224 ms by bot id=8370724288
2025-09-09 16:07:07,059 - aiogram.event - INFO - Update id=269252444 is handled. Duration 450 ms by bot id=8370724288
2025-09-09 16:07:08,677 - aiogram.event - INFO - Update id=269252445 is handled. Duration 151 ms by bot id=8370724288
2025-09-09 16:07:10,190 - aiogram.event - INFO - Update id=269252446 is handled. Duration 159 ms by bot id=8370724288
2025-09-09 16:07:11,549 - aiogram.event - INFO - Update id=269252447 is handled. Duration 86 ms by bot id=8370724288
2025-09-09 16:07:12,779 - aiogram.event - INFO - Update id=269252448 is handled. Duration 168 ms by bot id=8370724288
2025-09-09 16:07:13,774 - aiogram.event - INFO - Update id=269252449 is handled. Duration 152 ms by bot id=8370724288
2025-09-09 16:07:15,097 - aiogram.event - INFO - Update id=269252450 is handled. Duration 89 ms by bot id=8370724288
2025-09-09 16:07:15,984 - aiogram.event - INFO - Update id=269252451 is handled. Duration 158 ms by bot id=8370724288
2025-09-09 16:07:17,451 - aiogram.event - INFO - Update id=269252452 is handled. Duration 359 ms by bot id=8370724288
2025-09-09 16:15:52,770 - aiogram.event - INFO - Update id=269252453 is handled. Duration 356 ms by bot id=8370724288
2025-09-09 16:15:54,202 - aiogram.event - INFO - Update id=269252454 is handled. Duration 151 ms by bot id=8370724288
2025-09-09 16:15:55,293 - aiogram.event - INFO - Update id=269252455 is handled. Duration 277 ms by bot id=8370724288
2025-09-09 16:15:59,135 - aiogram.event - INFO - Update id=269252456 is handled. Duration 322 ms by bot id=8370724288
2025-09-09 16:16:01,060 - aiogram.event - INFO - Update id=269252457 is handled. Duration 186 ms by bot id=8370724288
2025-09-09 16:16:03,599 - aiogram.event - INFO - Update id=269252458 is handled. Duration 148 ms by bot id=8370724288
2025-09-09 16:16:06,376 - aiogram.event - INFO - Update id=269252459 is handled. Duration 191 ms by bot id=8370724288
2025-09-09 16:16:08,070 - aiogram.event - INFO - Update id=269252460 is handled. Duration 162 ms by bot id=8370724288
2025-09-09 16:16:13,361 - aiogram.event - INFO - Update id=269252461 is handled. Duration 164 ms by bot id=8370724288
2025-09-09 16:16:17,038 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-09 16:16:17,046 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-09 16:16:17,047 - aiogram.dispatcher - INFO - Polling stopped
2025-09-09 16:16:20,593 - __main__ - INFO - Bot starting...
2025-09-09 16:16:20,593 - aiogram.dispatcher - INFO - Start polling
2025-09-09 16:16:20,767 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-09 16:16:30,874 - __main__ - INFO - User 1226131544 started bot
2025-09-09 16:16:31,083 - aiogram.event - INFO - Update id=269252462 is handled. Duration 209 ms by bot id=8370724288
2025-09-09 16:16:43,763 - aiogram.event - INFO - Update id=269252463 is handled. Duration 147 ms by bot id=8370724288
2025-09-09 16:16:45,946 - aiogram.event - INFO - Update id=269252464 is handled. Duration 382 ms by bot id=8370724288
2025-09-09 16:16:47,455 - aiogram.event - INFO - Update id=269252465 is handled. Duration 453 ms by bot id=8370724288
2025-09-09 16:16:53,674 - aiogram.event - INFO - Update id=269252466 is handled. Duration 138 ms by bot id=8370724288
2025-09-09 16:16:54,678 - aiogram.event - INFO - Update id=269252467 is not handled. Duration 23 ms by bot id=8370724288
2025-09-09 16:16:54,678 - aiogram.event - ERROR - Cause exception while process update id=269252467 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x108f2f350> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 362, in on_qty
    f"✅ Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{cart_text}",
                     ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x108f2f350> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-09 16:16:56,053 - aiogram.event - INFO - Update id=269252468 is not handled. Duration 17 ms by bot id=8370724288
2025-09-09 16:16:56,053 - aiogram.event - ERROR - Cause exception while process update id=269252468 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x108d76420> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 362, in on_qty
    f"✅ Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{cart_text}",
                     ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x108d76420> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-09 16:16:57,250 - aiogram.event - INFO - Update id=269252469 is not handled. Duration 10 ms by bot id=8370724288
2025-09-09 16:16:57,250 - aiogram.event - ERROR - Cause exception while process update id=269252469 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x108d76990> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 362, in on_qty
    f"✅ Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{cart_text}",
                     ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x108d76990> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-09 16:17:00,951 - aiogram.event - INFO - Update id=269252470 is not handled. Duration 19 ms by bot id=8370724288
2025-09-09 16:17:00,952 - aiogram.event - ERROR - Cause exception while process update id=269252470 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x108d76cc0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 362, in on_qty
    f"✅ Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{cart_text}",
                     ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x108d76cc0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-09 16:17:03,626 - aiogram.event - INFO - Update id=269252471 is handled. Duration 94 ms by bot id=8370724288
2025-09-09 16:17:08,386 - aiogram.event - INFO - Update id=269252472 is handled. Duration 169 ms by bot id=8370724288
2025-09-09 16:17:11,464 - aiogram.event - INFO - Update id=269252473 is not handled. Duration 12 ms by bot id=8370724288
2025-09-09 16:17:11,465 - aiogram.event - ERROR - Cause exception while process update id=269252473 by bot id=8370724288
ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 444, in on_remove_item
    await cb.message.edit_text("✅ Корзина очищена!", reply_markup=main_menu_kb())
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/types/message.py", line 3670, in edit_text
    return EditMessageText(
           ^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/pydantic/main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2025-09-09 16:17:14,430 - aiogram.event - INFO - Update id=269252474 is handled. Duration 89 ms by bot id=8370724288
2025-09-09 16:17:17,904 - aiogram.event - INFO - Update id=269252475 is handled. Duration 141 ms by bot id=8370724288
2025-09-09 16:17:19,550 - aiogram.event - INFO - Update id=269252476 is handled. Duration 216 ms by bot id=8370724288
2025-09-09 16:17:20,641 - aiogram.event - INFO - Update id=269252477 is handled. Duration 133 ms by bot id=8370724288
2025-09-09 16:17:21,549 - aiogram.event - INFO - Update id=269252478 is handled. Duration 166 ms by bot id=8370724288
2025-09-09 16:17:22,687 - aiogram.event - INFO - Update id=269252479 is handled. Duration 174 ms by bot id=8370724288
2025-09-09 16:17:24,512 - aiogram.event - INFO - Update id=269252480 is not handled. Duration 11 ms by bot id=8370724288
2025-09-09 16:17:24,513 - aiogram.event - ERROR - Cause exception while process update id=269252480 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x10d1f43e0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 362, in on_qty
    f"✅ Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{cart_text}",
                     ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x10d1f43e0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-09 16:17:26,588 - aiogram.event - INFO - Update id=269252481 is handled. Duration 155 ms by bot id=8370724288
2025-09-09 16:17:28,394 - aiogram.event - INFO - Update id=269252482 is handled. Duration 187 ms by bot id=8370724288
2025-09-09 16:17:29,469 - aiogram.event - INFO - Update id=269252483 is not handled. Duration 13 ms by bot id=8370724288
2025-09-09 16:17:29,470 - aiogram.event - ERROR - Cause exception while process update id=269252483 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x10d1f54f0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 362, in on_qty
    f"✅ Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{cart_text}",
                     ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x10d1f54f0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-09 16:17:31,415 - aiogram.event - INFO - Update id=269252484 is handled. Duration 202 ms by bot id=8370724288
2025-09-09 16:17:35,965 - aiogram.event - INFO - Update id=269252485 is handled. Duration 120 ms by bot id=8370724288
2025-09-09 16:17:37,089 - aiogram.event - INFO - Update id=269252486 is handled. Duration 156 ms by bot id=8370724288
2025-09-09 16:17:37,972 - aiogram.event - INFO - Update id=269252487 is handled. Duration 169 ms by bot id=8370724288
2025-09-09 16:17:39,555 - aiogram.event - INFO - Update id=269252488 is handled. Duration 189 ms by bot id=8370724288
2025-09-09 16:17:40,541 - aiogram.event - INFO - Update id=269252489 is not handled. Duration 13 ms by bot id=8370724288
2025-09-09 16:17:40,542 - aiogram.event - ERROR - Cause exception while process update id=269252489 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x10d1f42c0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 362, in on_qty
    f"✅ Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{cart_text}",
                     ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x10d1f42c0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-09 16:17:42,103 - aiogram.event - INFO - Update id=269252490 is handled. Duration 187 ms by bot id=8370724288
2025-09-09 16:17:44,731 - aiogram.event - INFO - Update id=269252491 is handled. Duration 355 ms by bot id=8370724288
2025-09-09 16:17:46,558 - aiogram.event - INFO - Update id=269252492 is handled. Duration 213 ms by bot id=8370724288
2025-09-09 16:17:49,992 - aiogram.event - INFO - Update id=269252493 is handled. Duration 116 ms by bot id=8370724288
2025-09-09 16:17:51,703 - aiogram.event - INFO - Update id=269252494 is handled. Duration 83 ms by bot id=8370724288
2025-09-09 16:17:58,532 - aiogram.event - INFO - Update id=269252495 is handled. Duration 170 ms by bot id=8370724288
2025-09-09 16:18:01,284 - aiogram.event - INFO - Update id=269252496 is handled. Duration 351 ms by bot id=8370724288
2025-09-09 16:18:06,526 - aiogram.event - INFO - Update id=269252497 is handled. Duration 185 ms by bot id=8370724288
2025-09-09 16:18:10,896 - __main__ - INFO - Support request from 1226131544: f
2025-09-09 16:18:10,995 - aiogram.event - INFO - Update id=269252498 is handled. Duration 100 ms by bot id=8370724288
2025-09-09 16:18:22,532 - aiogram.event - INFO - Update id=269252499 is handled. Duration 118 ms by bot id=8370724288
2025-09-09 16:18:24,015 - aiogram.event - INFO - Update id=269252500 is handled. Duration 154 ms by bot id=8370724288
2025-09-09 16:18:29,147 - aiogram.event - INFO - Update id=269252501 is handled. Duration 88 ms by bot id=8370724288
2025-09-09 16:18:34,324 - aiogram.event - INFO - Update id=269252502 is handled. Duration 141 ms by bot id=8370724288
2025-09-09 16:18:36,242 - aiogram.event - INFO - Update id=269252503 is handled. Duration 157 ms by bot id=8370724288
2025-09-09 16:18:39,509 - aiogram.event - INFO - Update id=269252504 is handled. Duration 220 ms by bot id=8370724288
2025-09-09 16:18:42,560 - aiogram.event - INFO - Update id=269252505 is handled. Duration 295 ms by bot id=8370724288
2025-09-09 16:18:44,644 - aiogram.event - INFO - Update id=269252506 is handled. Duration 324 ms by bot id=8370724288
2025-09-09 16:18:46,845 - aiogram.event - INFO - Update id=269252507 is handled. Duration 311 ms by bot id=8370724288
2025-09-09 16:18:51,630 - aiogram.event - INFO - Update id=269252508 is handled. Duration 86 ms by bot id=8370724288
2025-09-09 16:18:56,601 - aiogram.event - INFO - Update id=269252509 is handled. Duration 163 ms by bot id=8370724288
2025-09-09 16:19:25,200 - aiogram.event - INFO - Update id=269252510 is handled. Duration 439 ms by bot id=8370724288
2025-09-09 16:19:28,268 - aiogram.event - INFO - Update id=269252511 is handled. Duration 152 ms by bot id=8370724288
2025-09-09 16:19:33,144 - aiogram.event - INFO - Update id=269252512 is handled. Duration 82 ms by bot id=8370724288
2025-09-09 16:19:34,783 - __main__ - ERROR - Error creating order: (psycopg2.errors.NotNullViolation) null value in column "phone" of relation "orders" violates not-null constraint
DETAIL:  Failing row contains (5, 1, ORD202509091619341066, pending, 0, jhkjl, null, cdek, {"city": "bbbb", "pvz": "r6r78"}, 2025-09-09 13:19:34.779294, 2025-09-09 13:19:34.7793).

[SQL: INSERT INTO orders (user_id, order_number, status, total_amount, fullname, phone, delivery_type, delivery_address, created_at, updated_at) VALUES (%(user_id)s, %(order_number)s, %(status)s, %(total_amount)s, %(fullname)s, %(phone)s, %(delivery_type)s, %(delivery_address)s::JSON, %(created_at)s, %(updated_at)s) RETURNING orders.id]
[parameters: {'user_id': 1, 'order_number': 'ORD202509091619341066', 'status': 'pending', 'total_amount': 0, 'fullname': 'jhkjl', 'phone': None, 'delivery_type': 'cdek', 'delivery_address': '{"city": "bbbb", "pvz": "r6r78"}', 'created_at': datetime.datetime(2025, 9, 9, 13, 19, 34, 779294), 'updated_at': datetime.datetime(2025, 9, 9, 13, 19, 34, 779300)}]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-09-09 16:19:34,929 - aiogram.event - INFO - Update id=269252513 is handled. Duration 167 ms by bot id=8370724288
2025-09-09 16:19:36,908 - aiogram.event - INFO - Update id=269252514 is not handled. Duration 2 ms by bot id=8370724288
2025-09-09 16:19:39,259 - aiogram.event - INFO - Update id=269252515 is not handled. Duration 2 ms by bot id=8370724288
2025-09-09 16:19:40,169 - aiogram.event - INFO - Update id=269252516 is handled. Duration 85 ms by bot id=8370724288
2025-09-09 16:19:47,655 - aiogram.event - INFO - Update id=269252517 is handled. Duration 167 ms by bot id=8370724288
2025-09-09 16:48:16,985 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-09-09 16:48:16,988 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8370724288)
2025-09-09 16:48:18,309 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8370724288)
2025-09-09 16:48:18,615 - aiogram.event - INFO - Update id=269252518 is handled. Duration 303 ms by bot id=8370724288
2025-09-09 16:48:18,644 - aiogram.event - INFO - Update id=269252519 is handled. Duration 329 ms by bot id=8370724288
2025-09-09 17:08:35,169 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-09-09 17:08:35,173 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8370724288)
2025-09-09 17:08:46,414 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8370724288)
2025-09-09 17:28:26,637 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-09-09 17:28:26,639 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8370724288)
2025-09-09 17:28:32,704 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8370724288)
2025-09-09 17:28:33,201 - aiogram.event - INFO - Update id=269252520 is handled. Duration 495 ms by bot id=8370724288
2025-09-09 17:28:34,511 - aiogram.event - INFO - Update id=269252521 is handled. Duration 156 ms by bot id=8370724288
2025-09-09 17:28:35,589 - aiogram.event - INFO - Update id=269252522 is handled. Duration 140 ms by bot id=8370724288
2025-09-09 17:28:36,684 - aiogram.event - INFO - Update id=269252523 is not handled. Duration 18 ms by bot id=8370724288
2025-09-09 17:28:36,684 - aiogram.event - ERROR - Cause exception while process update id=269252523 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x10d29e510> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 362, in on_qty
    f"✅ Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{cart_text}",
                     ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x10d29e510> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-09 17:28:38,701 - aiogram.event - INFO - Update id=269252524 is not handled. Duration 16 ms by bot id=8370724288
2025-09-09 17:28:38,701 - aiogram.event - ERROR - Cause exception while process update id=269252524 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x10d29e810> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 362, in on_qty
    f"✅ Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{cart_text}",
                     ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x10d29e810> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-09 17:28:39,122 - aiogram.event - INFO - Update id=269252525 is not handled. Duration 10 ms by bot id=8370724288
2025-09-09 17:28:39,123 - aiogram.event - ERROR - Cause exception while process update id=269252525 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x10d3b0080> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 362, in on_qty
    f"✅ Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{cart_text}",
                     ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x10d3b0080> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-09 17:28:39,339 - aiogram.event - INFO - Update id=269252526 is not handled. Duration 8 ms by bot id=8370724288
2025-09-09 17:28:39,339 - aiogram.event - ERROR - Cause exception while process update id=269252526 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x10d3b0050> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 362, in on_qty
    f"✅ Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{cart_text}",
                     ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x10d3b0050> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-09 17:28:39,554 - aiogram.event - INFO - Update id=269252527 is not handled. Duration 10 ms by bot id=8370724288
2025-09-09 17:28:39,554 - aiogram.event - ERROR - Cause exception while process update id=269252527 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x10d3c04a0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 362, in on_qty
    f"✅ Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{cart_text}",
                     ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x10d3c04a0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-09 17:28:39,785 - aiogram.event - INFO - Update id=269252528 is not handled. Duration 11 ms by bot id=8370724288
2025-09-09 17:28:39,786 - aiogram.event - ERROR - Cause exception while process update id=269252528 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x10d3c02c0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 362, in on_qty
    f"✅ Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{cart_text}",
                     ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x10d3c02c0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-09 17:28:44,079 - aiogram.event - INFO - Update id=269252529 is handled. Duration 89 ms by bot id=8370724288
2025-09-09 17:28:44,264 - aiogram.event - INFO - Update id=269252530 is not handled. Duration 10 ms by bot id=8370724288
2025-09-09 17:28:44,265 - aiogram.event - ERROR - Cause exception while process update id=269252530 by bot id=8370724288
DetachedInstanceError: Instance <Product at 0x10d3c09b0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 362, in on_qty
    f"✅ Добавлено: {product.name} — {size} × {qty} = *{product.price * qty} ₽*\n\n{cart_text}",
                     ^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 1607, in load_scalar_attributes
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Instance <Product at 0x10d3c09b0> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-09 17:32:51,570 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-09 17:32:51,578 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-09 17:32:51,579 - aiogram.dispatcher - INFO - Polling stopped
2025-09-09 17:32:54,365 - __main__ - INFO - Bot starting...
2025-09-09 17:32:54,365 - aiogram.dispatcher - INFO - Start polling
2025-09-09 17:32:54,548 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-09 17:33:01,236 - __main__ - INFO - User 1226131544 started bot
2025-09-09 17:33:01,486 - aiogram.event - INFO - Update id=269252531 is handled. Duration 249 ms by bot id=8370724288
2025-09-09 17:33:03,489 - aiogram.event - INFO - Update id=269252532 is handled. Duration 107 ms by bot id=8370724288
2025-09-09 17:33:04,652 - aiogram.event - INFO - Update id=269252533 is handled. Duration 155 ms by bot id=8370724288
2025-09-09 17:33:05,589 - aiogram.event - INFO - Update id=269252534 is handled. Duration 311 ms by bot id=8370724288
2025-09-09 17:33:06,586 - aiogram.event - INFO - Update id=269252535 is handled. Duration 143 ms by bot id=8370724288
2025-09-09 17:33:07,597 - aiogram.event - INFO - Update id=269252536 is handled. Duration 164 ms by bot id=8370724288
2025-09-09 17:33:10,471 - aiogram.event - INFO - Update id=269252537 is handled. Duration 194 ms by bot id=8370724288
2025-09-09 17:33:16,006 - aiogram.event - INFO - Update id=269252538 is not handled. Duration 27 ms by bot id=8370724288
2025-09-09 17:33:16,007 - aiogram.event - ERROR - Cause exception while process update id=269252538 by bot id=8370724288
TypeError: 'CartItem' object is not subscriptable
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 444, in on_cart_action
    reply_markup=cart_edit_ikb(cart_items)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 452, in cart_edit_ikb
    ib.button(text=f"❌ {item['name']} - {item['size']} × {item['quantity']}",
                        ~~~~^^^^^^^^
TypeError: 'CartItem' object is not subscriptable
2025-09-09 17:33:41,140 - aiogram.event - INFO - Update id=269252539 is handled. Duration 344 ms by bot id=8370724288
2025-09-09 17:33:43,316 - aiogram.event - INFO - Update id=269252540 is handled. Duration 195 ms by bot id=8370724288
2025-09-09 17:33:46,213 - aiogram.event - INFO - Update id=269252541 is handled. Duration 212 ms by bot id=8370724288
2025-09-09 17:33:47,720 - aiogram.event - INFO - Update id=269252542 is handled. Duration 153 ms by bot id=8370724288
2025-09-09 17:33:48,668 - aiogram.event - INFO - Update id=269252543 is handled. Duration 201 ms by bot id=8370724288
2025-09-09 17:33:50,105 - aiogram.event - INFO - Update id=269252544 is handled. Duration 137 ms by bot id=8370724288
2025-09-09 17:33:51,286 - aiogram.event - INFO - Update id=269252545 is handled. Duration 176 ms by bot id=8370724288
2025-09-09 17:33:54,035 - aiogram.event - INFO - Update id=269252546 is handled. Duration 117 ms by bot id=8370724288
2025-09-09 17:33:54,845 - aiogram.event - INFO - Update id=269252547 is not handled. Duration 9 ms by bot id=8370724288
2025-09-09 17:33:54,845 - aiogram.event - ERROR - Cause exception while process update id=269252547 by bot id=8370724288
TypeError: 'CartItem' object is not subscriptable
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 444, in on_cart_action
    reply_markup=cart_edit_ikb(cart_items)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 452, in cart_edit_ikb
    ib.button(text=f"❌ {item['name']} - {item['size']} × {item['quantity']}",
                        ~~~~^^^^^^^^
TypeError: 'CartItem' object is not subscriptable
2025-09-09 17:33:57,100 - aiogram.event - INFO - Update id=269252548 is handled. Duration 160 ms by bot id=8370724288
2025-09-09 17:34:00,119 - aiogram.event - INFO - Update id=269252549 is handled. Duration 192 ms by bot id=8370724288
2025-09-09 17:34:01,746 - aiogram.event - INFO - Update id=269252550 is handled. Duration 90 ms by bot id=8370724288
2025-09-09 17:34:03,903 - aiogram.event - INFO - Update id=269252551 is not handled. Duration 1 ms by bot id=8370724288
2025-09-09 17:34:05,725 - aiogram.event - INFO - Update id=269252552 is handled. Duration 240 ms by bot id=8370724288
2025-09-09 17:34:08,070 - aiogram.event - INFO - Update id=269252553 is handled. Duration 186 ms by bot id=8370724288
2025-09-09 17:34:09,381 - aiogram.event - INFO - Update id=269252554 is handled. Duration 182 ms by bot id=8370724288
2025-09-09 17:34:11,746 - aiogram.event - INFO - Update id=269252555 is handled. Duration 188 ms by bot id=8370724288
2025-09-09 17:34:14,882 - aiogram.event - INFO - Update id=269252556 is not handled. Duration 2 ms by bot id=8370724288
2025-09-09 17:34:19,378 - aiogram.event - INFO - Update id=269252557 is handled. Duration 166 ms by bot id=8370724288
2025-09-09 17:34:22,082 - aiogram.event - INFO - Update id=269252558 is handled. Duration 219 ms by bot id=8370724288
2025-09-09 17:34:22,953 - __main__ - INFO - Support request from 1226131544: ⬅️ Главное меню
2025-09-09 17:34:23,089 - aiogram.event - INFO - Update id=269252559 is handled. Duration 137 ms by bot id=8370724288
2025-09-09 17:36:49,781 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-09 17:36:49,785 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-09 17:36:49,785 - aiogram.dispatcher - INFO - Polling stopped
2025-09-09 17:36:53,407 - __main__ - INFO - Bot starting...
2025-09-09 17:36:53,407 - aiogram.dispatcher - INFO - Start polling
2025-09-09 17:36:53,584 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-09 17:36:56,530 - aiogram.event - INFO - Update id=269252560 is handled. Duration 218 ms by bot id=8370724288
2025-09-09 17:36:57,450 - aiogram.event - INFO - Update id=269252561 is handled. Duration 164 ms by bot id=8370724288
2025-09-09 17:36:58,424 - aiogram.event - INFO - Update id=269252562 is handled. Duration 161 ms by bot id=8370724288
2025-09-09 17:37:00,020 - aiogram.event - INFO - Update id=269252563 is handled. Duration 209 ms by bot id=8370724288
2025-09-09 17:37:01,580 - aiogram.event - INFO - Update id=269252564 is handled. Duration 246 ms by bot id=8370724288
2025-09-09 17:37:03,494 - aiogram.event - INFO - Update id=269252565 is handled. Duration 201 ms by bot id=8370724288
2025-09-09 17:37:04,574 - aiogram.event - INFO - Update id=269252566 is not handled. Duration 13 ms by bot id=8370724288
2025-09-09 17:37:04,574 - aiogram.event - ERROR - Cause exception while process update id=269252566 by bot id=8370724288
TypeError: 'CartItem' object is not subscriptable
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 439, in on_cart_action
    reply_markup=cart_edit_ikb(cart_items)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 447, in cart_edit_ikb
    ib.button(text=f"❌ {item['name']} - {item['size']} × {item['quantity']}",
                        ~~~~^^^^^^^^
TypeError: 'CartItem' object is not subscriptable
2025-09-09 17:37:16,638 - aiogram.event - INFO - Update id=269252567 is not handled. Duration 11 ms by bot id=8370724288
2025-09-09 17:37:16,638 - aiogram.event - ERROR - Cause exception while process update id=269252567 by bot id=8370724288
TypeError: 'CartItem' object is not subscriptable
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 439, in on_cart_action
    reply_markup=cart_edit_ikb(cart_items)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 447, in cart_edit_ikb
    ib.button(text=f"❌ {item['name']} - {item['size']} × {item['quantity']}",
                        ~~~~^^^^^^^^
TypeError: 'CartItem' object is not subscriptable
2025-09-09 17:48:18,329 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-09 17:48:18,336 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-09 17:48:18,337 - aiogram.dispatcher - INFO - Polling stopped
2025-09-09 18:14:50,390 - __main__ - INFO - Bot starting...
2025-09-09 18:14:50,390 - aiogram.dispatcher - INFO - Start polling
2025-09-09 18:14:50,568 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-09 18:15:01,889 - aiogram.event - INFO - Update id=269252568 is handled. Duration 337 ms by bot id=8370724288
2025-09-09 18:15:03,233 - aiogram.event - INFO - Update id=269252569 is handled. Duration 142 ms by bot id=8370724288
2025-09-09 18:15:05,034 - aiogram.event - INFO - Update id=269252570 is handled. Duration 372 ms by bot id=8370724288
2025-09-09 18:15:06,750 - aiogram.event - INFO - Update id=269252571 is handled. Duration 281 ms by bot id=8370724288
2025-09-09 18:15:09,535 - aiogram.event - INFO - Update id=269252572 is not handled. Duration 4 ms by bot id=8370724288
2025-09-09 18:15:09,536 - aiogram.event - ERROR - Cause exception while process update id=269252572 by bot id=8370724288
ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 473, in on_remove_item
    await cb.message.edit_text("✅ Корзина очищена!", reply_markup=main_menu_kb())
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/types/message.py", line 3670, in edit_text
    return EditMessageText(
           ^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/pydantic/main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2025-09-09 18:15:13,287 - aiogram.event - INFO - Update id=269252573 is handled. Duration 96 ms by bot id=8370724288
2025-09-09 18:15:15,433 - aiogram.event - INFO - Update id=269252574 is handled. Duration 125 ms by bot id=8370724288
2025-09-09 18:15:17,238 - aiogram.event - INFO - Update id=269252575 is handled. Duration 106 ms by bot id=8370724288
2025-09-09 18:15:18,767 - __main__ - INFO - Support request from 1226131544: ⬅️ Главное меню
2025-09-09 18:15:18,848 - aiogram.event - INFO - Update id=269252576 is handled. Duration 81 ms by bot id=8370724288
2025-09-09 18:15:21,371 - aiogram.event - INFO - Update id=269252577 is handled. Duration 104 ms by bot id=8370724288
2025-09-09 18:15:23,753 - aiogram.event - INFO - Update id=269252578 is handled. Duration 184 ms by bot id=8370724288
2025-09-10 20:30:53,269 - __main__ - INFO - Bot starting...
2025-09-10 20:30:53,270 - aiogram.dispatcher - INFO - Start polling
2025-09-10 20:30:53,473 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-10 20:30:57,659 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-09-10 20:30:57,659 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8370724288)
2025-09-10 20:31:03,293 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-09-10 20:31:03,294 - aiogram.dispatcher - WARNING - Sleep for 1.222723 seconds and try again... (tryings = 1, bot id = 8370724288)
2025-09-10 20:31:08,641 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-09-10 20:31:08,642 - aiogram.dispatcher - WARNING - Sleep for 1.656901 seconds and try again... (tryings = 2, bot id = 8370724288)
2025-09-10 20:31:12,656 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-10 20:31:12,661 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-10 20:31:12,662 - aiogram.dispatcher - INFO - Polling stopped
2025-09-10 20:31:15,575 - __main__ - INFO - Bot starting...
2025-09-10 20:31:15,576 - aiogram.dispatcher - INFO - Start polling
2025-09-10 20:31:15,754 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-10 20:31:17,577 - __main__ - INFO - User 1226131544 started bot
2025-09-10 20:31:17,823 - aiogram.event - INFO - Update id=269252836 is handled. Duration 250 ms by bot id=8370724288
2025-09-10 20:31:22,814 - aiogram.event - INFO - Update id=269252837 is handled. Duration 96 ms by bot id=8370724288
2025-09-10 20:31:24,005 - __main__ - INFO - Support request from 1226131544: ⬅️ Главное меню
2025-09-10 20:31:24,098 - aiogram.event - INFO - Update id=269252838 is handled. Duration 95 ms by bot id=8370724288
2025-09-10 20:31:28,229 - aiogram.event - INFO - Update id=269252839 is handled. Duration 160 ms by bot id=8370724288
2025-09-10 20:35:06,309 - aiogram.event - INFO - Update id=269252840 is handled. Duration 204 ms by bot id=8370724288
2025-09-10 20:35:07,892 - aiogram.event - INFO - Update id=269252841 is handled. Duration 85 ms by bot id=8370724288
2025-09-10 20:35:09,016 - aiogram.event - INFO - Update id=269252842 is handled. Duration 128 ms by bot id=8370724288
2025-09-10 20:35:10,340 - aiogram.event - INFO - Update id=269252843 is handled. Duration 158 ms by bot id=8370724288
2025-09-10 20:35:11,755 - aiogram.event - INFO - Update id=269252844 is handled. Duration 198 ms by bot id=8370724288
2025-09-10 20:35:12,654 - aiogram.event - INFO - Update id=269252845 is handled. Duration 91 ms by bot id=8370724288
2025-09-10 20:35:14,069 - __main__ - INFO - Support request from 1226131544: ⬅️ Главное меню
2025-09-10 20:35:14,159 - aiogram.event - INFO - Update id=269252846 is handled. Duration 92 ms by bot id=8370724288
2025-09-10 20:35:15,085 - aiogram.event - INFO - Update id=269252847 is handled. Duration 88 ms by bot id=8370724288
2025-09-10 20:35:18,451 - aiogram.event - INFO - Update id=269252848 is handled. Duration 168 ms by bot id=8370724288
2025-09-10 20:35:19,708 - aiogram.event - INFO - Update id=269252849 is handled. Duration 243 ms by bot id=8370724288
2025-09-10 20:35:20,822 - aiogram.event - INFO - Update id=269252850 is handled. Duration 184 ms by bot id=8370724288
2025-09-10 20:35:22,110 - aiogram.event - INFO - Update id=269252851 is handled. Duration 386 ms by bot id=8370724288
2025-09-10 20:35:24,070 - aiogram.event - INFO - Update id=269252852 is handled. Duration 118 ms by bot id=8370724288
2025-09-10 20:35:25,645 - aiogram.event - INFO - Update id=269252853 is handled. Duration 182 ms by bot id=8370724288
2025-09-10 21:02:43,754 - aiogram.event - INFO - Update id=269252854 is handled. Duration 216 ms by bot id=8370724288
2025-09-10 21:02:45,324 - aiogram.event - INFO - Update id=269252855 is handled. Duration 311 ms by bot id=8370724288
2025-09-10 21:02:47,065 - aiogram.event - INFO - Update id=269252856 is handled. Duration 401 ms by bot id=8370724288
2025-09-10 21:02:47,857 - aiogram.event - INFO - Update id=269252857 is handled. Duration 139 ms by bot id=8370724288
2025-09-10 21:02:48,707 - aiogram.event - INFO - Update id=269252858 is handled. Duration 153 ms by bot id=8370724288
2025-09-10 21:02:49,635 - aiogram.event - INFO - Update id=269252859 is handled. Duration 70 ms by bot id=8370724288
2025-09-10 21:02:50,680 - aiogram.event - INFO - Update id=269252860 is handled. Duration 142 ms by bot id=8370724288
2025-09-10 21:02:57,869 - aiogram.event - INFO - Update id=269252861 is handled. Duration 90 ms by bot id=8370724288
2025-09-10 21:02:59,329 - aiogram.event - INFO - Update id=269252862 is handled. Duration 258 ms by bot id=8370724288
2025-09-10 21:03:01,261 - aiogram.event - INFO - Update id=269252863 is handled. Duration 96 ms by bot id=8370724288
2025-09-10 21:03:03,010 - aiogram.event - INFO - Update id=269252864 is handled. Duration 192 ms by bot id=8370724288
2025-09-10 21:03:05,298 - aiogram.event - INFO - Update id=269252865 is handled. Duration 366 ms by bot id=8370724288
2025-09-10 21:03:06,268 - aiogram.event - INFO - Update id=269252866 is handled. Duration 85 ms by bot id=8370724288
2025-09-10 21:03:09,259 - aiogram.event - INFO - Update id=269252867 is handled. Duration 180 ms by bot id=8370724288
2025-09-10 21:03:12,148 - aiogram.event - INFO - Update id=269252868 is handled. Duration 135 ms by bot id=8370724288
2025-09-10 21:10:51,043 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-10 21:10:51,053 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-10 21:10:51,053 - aiogram.dispatcher - INFO - Polling stopped
2025-09-10 21:18:45,646 - __main__ - INFO - Bot starting...
2025-09-10 21:18:45,647 - aiogram.dispatcher - INFO - Start polling
2025-09-10 21:18:45,860 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-10 21:18:46,130 - aiogram.event - INFO - Update id=269252883 is not handled. Duration 2 ms by bot id=8370724288
2025-09-10 21:18:47,068 - aiogram.event - INFO - Update id=269252884 is handled. Duration 274 ms by bot id=8370724288
2025-09-10 21:18:47,536 - aiogram.event - INFO - Update id=269252885 is handled. Duration 91 ms by bot id=8370724288
2025-09-10 21:18:48,285 - aiogram.event - INFO - Update id=269252886 is handled. Duration 112 ms by bot id=8370724288
2025-09-10 21:18:52,594 - __main__ - INFO - User 1226131544 started bot
2025-09-10 21:18:52,691 - aiogram.event - INFO - Update id=269252887 is handled. Duration 99 ms by bot id=8370724288
2025-09-10 21:18:58,448 - aiogram.event - INFO - Update id=269252888 is handled. Duration 114 ms by bot id=8370724288
2025-09-10 21:18:59,731 - aiogram.event - INFO - Update id=269252889 is handled. Duration 276 ms by bot id=8370724288
2025-09-10 21:19:22,499 - aiogram.event - INFO - Update id=269252890 is handled. Duration 276 ms by bot id=8370724288
2025-09-10 21:19:24,701 - aiogram.event - INFO - Update id=269252891 is handled. Duration 170 ms by bot id=8370724288
2025-09-10 21:19:27,148 - aiogram.event - INFO - Update id=269252892 is handled. Duration 468 ms by bot id=8370724288
2025-09-10 21:19:33,163 - aiogram.event - INFO - Update id=269252893 is handled. Duration 201 ms by bot id=8370724288
2025-09-10 21:19:34,942 - aiogram.event - INFO - Update id=269252894 is handled. Duration 236 ms by bot id=8370724288
2025-09-10 21:19:37,144 - aiogram.event - INFO - Update id=269252895 is not handled. Duration 143 ms by bot id=8370724288
2025-09-10 21:19:37,144 - aiogram.event - ERROR - Cause exception while process update id=269252895 by bot id=8370724288
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/admins_panel.py", line 678, in adm_order_set_status
    await adm_order_view(cb)
  File "/Users/oleg/TG_BOT_t-short/admins_panel.py", line 652, in adm_order_view
    await cb.message.edit_text("\n".join(lines), parse_mode="Markdown", reply_markup=ib.as_markup())
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/client/bot.py", line 494, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-09-10 21:19:41,261 - aiogram.event - INFO - Update id=269252896 is handled. Duration 99 ms by bot id=8370724288
2025-09-10 21:19:46,236 - aiogram.event - INFO - Update id=269252897 is handled. Duration 863 ms by bot id=8370724288
2025-09-10 21:19:48,495 - aiogram.event - INFO - Update id=269252898 is handled. Duration 94 ms by bot id=8370724288
2025-09-10 21:19:50,669 - aiogram.event - INFO - Update id=269252899 is handled. Duration 221 ms by bot id=8370724288
2025-09-10 21:19:52,272 - aiogram.event - INFO - Update id=269252900 is handled. Duration 84 ms by bot id=8370724288
2025-09-10 21:19:54,598 - aiogram.event - INFO - Update id=269252901 is handled. Duration 235 ms by bot id=8370724288
2025-09-10 21:19:56,930 - aiogram.event - INFO - Update id=269252902 is handled. Duration 93 ms by bot id=8370724288
2025-09-10 21:19:58,170 - aiogram.event - INFO - Update id=269252903 is handled. Duration 163 ms by bot id=8370724288
2025-09-10 21:29:19,146 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-09-10 21:29:19,149 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8370724288)
2025-09-10 21:29:30,350 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8370724288)
2025-09-10 21:45:11,440 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-09-10 21:45:11,445 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8370724288)
2025-09-10 21:45:22,662 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8370724288)
2025-09-10 21:55:04,826 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-09-10 21:55:04,829 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8370724288)
2025-09-10 21:55:16,097 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8370724288)
2025-09-10 22:11:38,237 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-10 22:11:38,247 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-10 22:11:38,248 - aiogram.dispatcher - INFO - Polling stopped
2025-09-10 22:11:41,672 - __main__ - INFO - Bot starting...
2025-09-10 22:11:41,672 - aiogram.dispatcher - INFO - Start polling
2025-09-10 22:11:41,862 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-10 22:12:06,525 - aiogram.event - INFO - Update id=269252904 is handled. Duration 305 ms by bot id=8370724288
2025-09-10 22:12:10,744 - aiogram.event - INFO - Update id=269252905 is not handled. Duration 3 ms by bot id=8370724288
2025-09-10 22:12:15,108 - __main__ - INFO - User 1226131544 started bot
2025-09-10 22:12:15,287 - aiogram.event - INFO - Update id=269252906 is handled. Duration 185 ms by bot id=8370724288
2025-09-10 22:12:18,729 - aiogram.event - INFO - Update id=269252907 is handled. Duration 83 ms by bot id=8370724288
2025-09-10 22:12:19,945 - aiogram.event - INFO - Update id=269252908 is handled. Duration 85 ms by bot id=8370724288
2025-09-10 22:12:29,927 - __main__ - INFO - Support request from 1226131544: привет
2025-09-10 22:12:30,215 - aiogram.event - INFO - Update id=269252909 is handled. Duration 404 ms by bot id=8370724288
2025-09-10 22:12:44,353 - aiogram.event - INFO - Update id=269252910 is handled. Duration 203 ms by bot id=8370724288
2025-09-10 22:12:49,209 - aiogram.event - INFO - Update id=269252911 is handled. Duration 349 ms by bot id=8370724288
2025-09-10 22:12:54,851 - aiogram.event - INFO - Update id=269252912 is handled. Duration 90 ms by bot id=8370724288
2025-09-10 22:13:02,146 - aiogram.event - INFO - Update id=269252913 is not handled. Duration 15 ms by bot id=8370724288
2025-09-10 22:13:02,147 - aiogram.event - ERROR - Cause exception while process update id=269252913 by bot id=8370724288
UnicodeEncodeError: 'charmap' codec can't encode characters in position 0-1: character maps to <undefined>
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/bot.py", line 587, in on_support_message
    ticket = TicketRepository.create_ticket(db, user.id, support_message)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/repositories.py", line 228, in create_ticket
    db.commit()
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2032, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4345, in flush
    self._flush(objects)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4480, in _flush
    with util.safe_reraise():
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4441, in _flush
    flush_context.execute()
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2358, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "/opt/anaconda3/lib/python3.12/encodings/cp866.py", line 12, in encode
    return codecs.charmap_encode(input,errors,encoding_map)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'charmap' codec can't encode characters in position 0-1: character maps to <undefined>
2025-09-10 22:13:09,141 - __main__ - INFO - Support request from 1226131544: в
2025-09-10 22:13:09,415 - aiogram.event - INFO - Update id=269252914 is handled. Duration 287 ms by bot id=8370724288
2025-09-10 22:13:12,215 - aiogram.event - INFO - Update id=269252915 is handled. Duration 230 ms by bot id=8370724288
2025-09-10 22:13:15,590 - aiogram.event - INFO - Update id=269252916 is not handled. Duration 7 ms by bot id=8370724288
2025-09-10 22:13:15,590 - aiogram.event - ERROR - Cause exception while process update id=269252916 by bot id=8370724288
DetachedInstanceError: Parent instance <Ticket at 0x11761a210> is not bound to a Session; lazy load operation of attribute 'user' cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/admins_panel.py", line 669, in adm_support_list
    user_tag = mention_user(ticket.user.telegram_id, ticket.user.username, ticket.user.first_name, ticket.user.last_name)
                            ^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1131, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/strategies.py", line 922, in _load_for_state
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Parent instance <Ticket at 0x11761a210> is not bound to a Session; lazy load operation of attribute 'user' cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-10 22:13:19,181 - aiogram.event - INFO - Update id=269252917 is not handled. Duration 11 ms by bot id=8370724288
2025-09-10 22:13:19,182 - aiogram.event - ERROR - Cause exception while process update id=269252917 by bot id=8370724288
DetachedInstanceError: Parent instance <Ticket at 0x11761ac30> is not bound to a Session; lazy load operation of attribute 'user' cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/admins_panel.py", line 669, in adm_support_list
    user_tag = mention_user(ticket.user.telegram_id, ticket.user.username, ticket.user.first_name, ticket.user.last_name)
                            ^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1131, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/strategies.py", line 922, in _load_for_state
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Parent instance <Ticket at 0x11761ac30> is not bound to a Session; lazy load operation of attribute 'user' cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-10 22:13:22,260 - aiogram.event - INFO - Update id=269252918 is not handled. Duration 7 ms by bot id=8370724288
2025-09-10 22:13:22,260 - aiogram.event - ERROR - Cause exception while process update id=269252918 by bot id=8370724288
DetachedInstanceError: Parent instance <Ticket at 0x11761b0e0> is not bound to a Session; lazy load operation of attribute 'user' cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/admins_panel.py", line 669, in adm_support_list
    user_tag = mention_user(ticket.user.telegram_id, ticket.user.username, ticket.user.first_name, ticket.user.last_name)
                            ^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1131, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/strategies.py", line 922, in _load_for_state
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Parent instance <Ticket at 0x11761b0e0> is not bound to a Session; lazy load operation of attribute 'user' cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-10 22:13:25,144 - aiogram.event - INFO - Update id=269252919 is handled. Duration 255 ms by bot id=8370724288
2025-09-10 22:13:28,401 - aiogram.event - INFO - Update id=269252920 is not handled. Duration 8 ms by bot id=8370724288
2025-09-10 22:13:32,574 - aiogram.event - INFO - Update id=269252921 is not handled. Duration 3 ms by bot id=8370724288
2025-09-10 22:13:38,212 - aiogram.event - INFO - Update id=269252922 is handled. Duration 98 ms by bot id=8370724288
2025-09-10 22:13:39,828 - aiogram.event - INFO - Update id=269252923 is handled. Duration 138 ms by bot id=8370724288
2025-09-10 22:13:41,091 - aiogram.event - INFO - Update id=269252924 is not handled. Duration 15 ms by bot id=8370724288
2025-09-10 22:13:41,091 - aiogram.event - ERROR - Cause exception while process update id=269252924 by bot id=8370724288
DetachedInstanceError: Parent instance <Ticket at 0x1176191c0> is not bound to a Session; lazy load operation of attribute 'user' cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/admins_panel.py", line 669, in adm_support_list
    user_tag = mention_user(ticket.user.telegram_id, ticket.user.username, ticket.user.first_name, ticket.user.last_name)
                            ^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1131, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/strategies.py", line 922, in _load_for_state
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Parent instance <Ticket at 0x1176191c0> is not bound to a Session; lazy load operation of attribute 'user' cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-10 22:13:42,192 - aiogram.event - INFO - Update id=269252925 is not handled. Duration 6 ms by bot id=8370724288
2025-09-10 22:13:42,192 - aiogram.event - ERROR - Cause exception while process update id=269252925 by bot id=8370724288
DetachedInstanceError: Parent instance <Ticket at 0x11761bd70> is not bound to a Session; lazy load operation of attribute 'user' cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/admins_panel.py", line 669, in adm_support_list
    user_tag = mention_user(ticket.user.telegram_id, ticket.user.username, ticket.user.first_name, ticket.user.last_name)
                            ^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1131, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/strategies.py", line 922, in _load_for_state
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Parent instance <Ticket at 0x11761bd70> is not bound to a Session; lazy load operation of attribute 'user' cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-10 22:13:43,510 - aiogram.event - INFO - Update id=269252926 is not handled. Duration 6 ms by bot id=8370724288
2025-09-10 22:13:43,510 - aiogram.event - ERROR - Cause exception while process update id=269252926 by bot id=8370724288
DetachedInstanceError: Parent instance <Ticket at 0x11761b890> is not bound to a Session; lazy load operation of attribute 'user' cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/admins_panel.py", line 669, in adm_support_list
    user_tag = mention_user(ticket.user.telegram_id, ticket.user.username, ticket.user.first_name, ticket.user.last_name)
                            ^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/attributes.py", line 1131, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/sqlalchemy/orm/strategies.py", line 922, in _load_for_state
    raise orm_exc.DetachedInstanceError(
sqlalchemy.orm.exc.DetachedInstanceError: Parent instance <Ticket at 0x11761b890> is not bound to a Session; lazy load operation of attribute 'user' cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)
2025-09-10 22:13:44,558 - aiogram.event - INFO - Update id=269252927 is handled. Duration 187 ms by bot id=8370724288
2025-09-10 22:37:48,671 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-10 22:37:48,681 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-10 22:37:48,682 - aiogram.dispatcher - INFO - Polling stopped
2025-09-10 22:37:51,800 - __main__ - INFO - Bot starting...
2025-09-10 22:37:51,800 - aiogram.dispatcher - INFO - Start polling
2025-09-10 22:37:52,010 - aiogram.dispatcher - INFO - Run polling for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-10 22:37:58,536 - aiogram.event - INFO - Update id=269252928 is handled. Duration 669 ms by bot id=8370724288
2025-09-10 22:38:00,454 - aiogram.event - INFO - Update id=269252929 is handled. Duration 252 ms by bot id=8370724288
2025-09-10 22:38:02,185 - aiogram.event - INFO - Update id=269252930 is handled. Duration 203 ms by bot id=8370724288
2025-09-10 22:38:06,208 - aiogram.event - INFO - Update id=269252931 is handled. Duration 302 ms by bot id=8370724288
2025-09-10 22:38:07,736 - aiogram.event - INFO - Update id=269252932 is not handled. Duration 146 ms by bot id=8370724288
2025-09-10 22:38:07,737 - aiogram.event - ERROR - Cause exception while process update id=269252932 by bot id=8370724288
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/admins_panel.py", line 836, in adm_support_reopen
    await adm_support_view(cb)
  File "/Users/oleg/TG_BOT_t-short/admins_panel.py", line 717, in adm_support_view
    await cb.message.edit_text(text, parse_mode="Markdown", reply_markup=ticket_actions_kb(ticket.id))
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/client/bot.py", line 494, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/client/session/aiohttp.py", line 189, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "/Users/oleg/TG_BOT_t-short/venv/lib/python3.12/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-09-10 22:38:11,035 - aiogram.event - INFO - Update id=269252933 is handled. Duration 296 ms by bot id=8370724288
2025-09-10 22:38:12,983 - aiogram.event - INFO - Update id=269252934 is handled. Duration 331 ms by bot id=8370724288
2025-09-10 22:38:14,778 - aiogram.event - INFO - Update id=269252935 is handled. Duration 142 ms by bot id=8370724288
2025-09-10 22:38:20,762 - aiogram.event - INFO - Update id=269252936 is handled. Duration 102 ms by bot id=8370724288
2025-09-10 22:38:25,927 - aiogram.event - INFO - Update id=269252937 is not handled. Duration 6 ms by bot id=8370724288
2025-09-10 22:38:28,382 - aiogram.event - INFO - Update id=269252938 is handled. Duration 84 ms by bot id=8370724288
2025-09-10 22:38:30,248 - aiogram.event - INFO - Update id=269252939 is handled. Duration 139 ms by bot id=8370724288
2025-09-10 22:38:31,591 - aiogram.event - INFO - Update id=269252940 is handled. Duration 150 ms by bot id=8370724288
2025-09-10 22:38:32,969 - aiogram.event - INFO - Update id=269252941 is handled. Duration 162 ms by bot id=8370724288
2025-09-10 22:38:34,555 - aiogram.event - INFO - Update id=269252942 is handled. Duration 149 ms by bot id=8370724288
2025-09-10 22:38:37,889 - aiogram.event - INFO - Update id=269252943 is handled. Duration 147 ms by bot id=8370724288
2025-09-10 22:38:41,286 - aiogram.event - INFO - Update id=269252944 is handled. Duration 560 ms by bot id=8370724288
2025-09-10 22:38:45,825 - aiogram.event - INFO - Update id=269252945 is handled. Duration 75 ms by bot id=8370724288
2025-09-10 22:38:46,909 - aiogram.event - INFO - Update id=269252946 is handled. Duration 143 ms by bot id=8370724288
2025-09-10 22:38:48,065 - aiogram.event - INFO - Update id=269252947 is handled. Duration 223 ms by bot id=8370724288
2025-09-10 22:38:49,370 - aiogram.event - INFO - Update id=269252948 is handled. Duration 189 ms by bot id=8370724288
2025-09-10 22:38:50,563 - aiogram.event - INFO - Update id=269252949 is handled. Duration 157 ms by bot id=8370724288
2025-09-10 22:38:54,521 - aiogram.event - INFO - Update id=269252950 is handled. Duration 1421 ms by bot id=8370724288
2025-09-10 22:38:57,132 - aiogram.event - INFO - Update id=269252951 is handled. Duration 175 ms by bot id=8370724288
2025-09-10 22:39:05,185 - aiogram.event - INFO - Update id=269252952 is handled. Duration 79 ms by bot id=8370724288
2025-09-10 22:39:06,245 - aiogram.event - INFO - Update id=269252953 is handled. Duration 132 ms by bot id=8370724288
2025-09-10 22:39:07,805 - aiogram.event - INFO - Update id=269252954 is handled. Duration 151 ms by bot id=8370724288
2025-09-10 22:39:08,548 - aiogram.event - INFO - Update id=269252955 is handled. Duration 151 ms by bot id=8370724288
2025-09-10 22:39:10,128 - aiogram.event - INFO - Update id=269252956 is handled. Duration 147 ms by bot id=8370724288
2025-09-10 22:39:24,430 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-10 22:39:24,432 - aiogram.dispatcher - INFO - Polling stopped for bot @emperador_test_bot id=8370724288 - 'Emperador'
2025-09-10 22:39:24,432 - aiogram.dispatcher - INFO - Polling stopped
